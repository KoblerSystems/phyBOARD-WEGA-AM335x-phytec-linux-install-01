<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>Build and Use Phytec Linux BSP on Phytec phyBOARD-WEGA-AM335x</title><meta name="generator" content="DocBook XSL Stylesheets V1.78.0"><style type="text/css">pre.screen {  background-color: #FFFF99 ;  border: 1px solid #006600 ;}pre.screen { padding: 1em; border: 1px dashed rgb(47, 111, 171); color: black; background-color: rgb(249, 249, 249); line-height: 1.1em; }code.code {  color: darkgreen;   font-weight: bold;   font-family: monospace;}</style></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div lang="en" class="article"><div class="titlepage"><div><div><h2 class="title"><a name="idm140495282537168"></a>Build and Use Phytec Linux BSP on Phytec phyBOARD-WEGA-AM335x</h2></div></div><hr></div><div class="toc"><p><b>Table of Contents</b></p><dl class="toc"><dt><span class="sect1"><a href="#idm140495282579040">1. License</a></span></dt><dt><span class="sect1"><a href="#idm140495282575408">2. About this manual</a></span></dt><dt><span class="sect1"><a href="#idm140495282574448">3. Folder, Filenames and Macros</a></span></dt><dt><span class="sect1"><a href="#idm140495282491824">4. Environment</a></span></dt><dt><span class="sect1"><a href="#idm140495282488976">5. Install Software on the host</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idm140495282486512">5.1. Install third party software on the host</a></span></dt><dt><span class="sect2"><a href="#idm140495282486256">5.2. Install Phytec software on the host</a></span></dt></dl></dd><dt><span class="sect1"><a href="#idm140495282474176">6. Barebox configuration</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idm140495282472224">6.1. Edit barebox files on the target</a></span></dt><dt><span class="sect2"><a href="#idm140495282469744">6.2. Default settings</a></span></dt></dl></dd><dt><span class="sect1"><a href="#idm140495282468208">7. Makefile</a></span></dt><dt><span class="sect1"><a href="#Quick_Start_Source_1">8. Quick Start: Use the Source Code of Phytec Linux Without Changing It</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idm140495282439248">8.1. Install Tools and BSP</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idm140495282438608">8.1.1. Install Tools and BSP for Phytec Linux - First Time</a></span></dt><dd><dl><dt><span class="sect4"><a href="#idm140495282437296">8.1.1.1. Download Docs</a></span></dt><dt><span class="sect4"><a href="#idm140495282435760">8.1.1.2. Ptxdist</a></span></dt><dt><span class="sect4"><a href="#idm140495282431264">8.1.1.3. Toolchain</a></span></dt><dt><span class="sect4"><a href="#idm140495282430944">8.1.1.4. BSP</a></span></dt><dt><span class="sect4"><a href="#idm140495282421728">8.1.1.5. Barebox environment for tftpboot folder</a></span></dt><dt><span class="sect4"><a href="#idm140495282415216">8.1.1.6. Summary</a></span></dt></dl></dd></dl></dd><dt><span class="sect2"><a href="#idm140495282408128">8.2. Build BSP for Phytec Linux - First Time</a></span></dt><dt><span class="sect2"><a href="#idm140495282407968">8.3. Use Binary Versions of Phytec Linux - First Time</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idm140495282396592">8.3.1. Create Archives of Filesystems and Install  Phytec Linux BSP on SD-Card for boot_mmc</a></span></dt><dt><span class="sect3"><a href="#idm140495282393568">8.3.2. Update Bootloader in NAND</a></span></dt><dd><dl><dt><span class="sect4"><a href="#idm140495282390160">8.3.2.1. Use images from SD-Card</a></span></dt><dd><dl><dt><span class="sect5"><a href="#idm140495282386752">8.3.2.1.1. Boot from SD-Card</a></span></dt><dt><span class="sect5"><a href="#idm140495282386496">8.3.2.1.2. Mount SD-Card</a></span></dt></dl></dd><dt><span class="sect4"><a href="#idm140495282379360">8.3.2.2. Download images from TFTP Server</a></span></dt></dl></dd><dt><span class="sect3"><a href="#idm140495282367632">8.3.3. Boot via NAND</a></span></dt><dt><span class="sect3"><a href="#idm140495282367312">8.3.4. Boot via TFTP and NFS</a></span></dt><dd><dl><dt><span class="sect4"><a href="#idm140495282361280">8.3.4.1. Prepare tftp config</a></span></dt><dt><span class="sect4"><a href="#idm140495282357456">8.3.4.2. Copy init files to the Target </a></span></dt><dt><span class="sect4"><a href="#idm140495282350368">8.3.4.3. Setup barebox config to boot via tftp and nfs </a></span></dt><dt><span class="sect4"><a href="#idm140495282348512">8.3.4.4. Prepare kernel and rootfs for boot via TFTP and NFS </a></span></dt><dt><span class="sect4"><a href="#idm140495282348224">8.3.4.5. Switching between booting from NAND and via TFTP and NFS</a></span></dt></dl></dd><dt><span class="sect3"><a href="#idm140495282333664">8.3.5. Boot the board</a></span></dt><dt><span class="sect3"><a href="#idm140495282333408">8.3.6. Summary</a></span></dt></dl></dd><dt><span class="sect2"><a href="#idm140495282319808">8.4. Test or Debug</a></span></dt></dl></dd><dt><span class="sect1"><a href="#Develop_Source_1">9. Development: Use and Change the Source Code of Phytec Linux</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idm140495282308624">9.1. Install Tools and BSP for Phytec Linux - First Time</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idm140495282307248">9.1.1. Download Docs</a></span></dt><dt><span class="sect3"><a href="#idm140495282305328">9.1.2. Ptxdist</a></span></dt><dt><span class="sect3"><a href="#idm140495282297088">9.1.3. Toolchain</a></span></dt><dt><span class="sect3"><a href="#idm140495282296960">9.1.4. BSP</a></span></dt><dt><span class="sect3"><a href="#idm140495282296832">9.1.5. Barebox environment for tftpboot folder</a></span></dt><dt><span class="sect3"><a href="#idm140495282296672">9.1.6. Summary</a></span></dt></dl></dd><dt><span class="sect2"><a href="#idm140495282266064">9.2. Install Tools and BSP for Phytec Linux - Again</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idm140495282263184">9.2.1. Download Docs</a></span></dt><dt><span class="sect3"><a href="#idm140495282261296">9.2.2. Ptxdist</a></span></dt><dt><span class="sect3"><a href="#idm140495282260976">9.2.3. Toolchain</a></span></dt><dt><span class="sect3"><a href="#idm140495282252640">9.2.4. BSP</a></span></dt><dt><span class="sect3"><a href="#idm140495282252480">9.2.5. Barebox environment for tftpboot folder</a></span></dt><dt><span class="sect3"><a href="#idm140495282224576">9.2.6. Summary</a></span></dt></dl></dd><dt><span class="sect2"><a href="#idm140495282265808">9.3. Build BSP for Phytec Linux - First Time</a></span></dt><dt><span class="sect2"><a href="#idm140495282220224">9.4. Develop BSP Phytec Linux - First Time</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idm140495282208688">9.4.1. Call the ptxdist command directly</a></span></dt><dt><span class="sect3"><a href="#idm140495282203312">9.4.2. Development of the Kernel</a></span></dt><dd><dl><dt><span class="sect4"><a href="#idm140495282202480">9.4.2.1. Kernel config</a></span></dt><dt><span class="sect4"><a href="#idm140495282199664">9.4.2.2. Kernel source</a></span></dt></dl></dd><dt><span class="sect3"><a href="#idm140495282198864">9.4.3. Development of barebox</a></span></dt><dd><dl><dt><span class="sect4"><a href="#idm140495282186176">9.4.3.1. Barebox source</a></span></dt><dt><span class="sect4"><a href="#idm140495282185760">9.4.3.2. After changes in tftpboot environment</a></span></dt></dl></dd></dl></dd><dt><span class="sect2"><a href="#idm140495282169776">9.5. Develop BSP for Phytec Linux - Again</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idm140495282167472">9.5.1. Call the ptxdist command directly</a></span></dt><dt><span class="sect3"><a href="#idm140495282162128">9.5.2. Development of the Kernel</a></span></dt><dd><dl><dt><span class="sect4"><a href="#idm140495282161424">9.5.2.1. Kernel config</a></span></dt><dt><span class="sect4"><a href="#idm140495282158464">9.5.2.2. Kernel source</a></span></dt></dl></dd><dt><span class="sect3"><a href="#idm140495282158080">9.5.3. Development of barebox</a></span></dt><dd><dl><dt><span class="sect4"><a href="#idm140495282144768">9.5.3.1. Barebox source</a></span></dt><dt><span class="sect4"><a href="#idm140495282144000">9.5.3.2. After changes in tftpboot environment</a></span></dt></dl></dd></dl></dd><dt><span class="sect2"><a href="#idm140495282128128">9.6. Build BSP for Phytec Linux - Again</a></span></dt><dt><span class="sect2"><a href="#idm140495282123280">9.7. Use Binary Versions of Phytec Linux - First Time</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idm140495282121632">9.7.1. Create Archives of Filesystems and Install  Phytec Linux BSP on SD-Card for boot_mmc</a></span></dt><dt><span class="sect3"><a href="#idm140495282118704">9.7.2. Update Bootloader in NAND</a></span></dt><dd><dl><dt><span class="sect4"><a href="#idm140495282115296">9.7.2.1. Use images from SD-Card</a></span></dt><dd><dl><dt><span class="sect5"><a href="#idm140495282112016">9.7.2.1.1. Boot from SD-Card</a></span></dt><dt><span class="sect5"><a href="#idm140495282111760">9.7.2.1.2. Mount SD-Card</a></span></dt></dl></dd><dt><span class="sect4"><a href="#idm140495282104624">9.7.2.2. Download images from TFTP Server</a></span></dt></dl></dd><dt><span class="sect3"><a href="#idm140495282092896">9.7.3. Boot via NAND</a></span></dt><dt><span class="sect3"><a href="#Boot_via_TFTP_and_NFS">9.7.4. Boot via TFTP and NFS</a></span></dt><dd><dl><dt><span class="sect4"><a href="#idm140495282086144">9.7.4.1. Prepare tftp config</a></span></dt><dt><span class="sect4"><a href="#idm140495282082288">9.7.4.2. Copy init files to the Target </a></span></dt><dt><span class="sect4"><a href="#idm140495282075360">9.7.4.3. Setup barebox config to boot via tftp and nfs </a></span></dt><dt><span class="sect4"><a href="#idm140495282073600">9.7.4.4. Prepare kernel and rootfs for boot via TFTP and NFS </a></span></dt><dt><span class="sect4"><a href="#idm140495282073472">9.7.4.5. Switching between booting from NAND and via TFTP and NFS</a></span></dt></dl></dd><dt><span class="sect3"><a href="#idm140495282058688">9.7.5. Boot the board</a></span></dt><dt><span class="sect3"><a href="#idm140495282058304">9.7.6. Summary</a></span></dt></dl></dd><dt><span class="sect2"><a href="#idm140495282044736">9.8. Use Binary Versions of Phytec Linux - Again</a></span></dt><dd><dl><dt><span class="sect3"><a href="#idm140495282034976">9.8.1. Create Archives of Filesystems and Install  Phytec Linux BSP on SD-Card for boot_mmc</a></span></dt><dt><span class="sect3"><a href="#idm140495282029136">9.8.2. Update Bootloader in NAND</a></span></dt><dd><dl><dt><span class="sect4"><a href="#idm140495282025648">9.8.2.1. Use images from SD-Card</a></span></dt><dd><dl><dt><span class="sect5"><a href="#idm140495282022224">9.8.2.1.1. Boot from SD-Card</a></span></dt><dt><span class="sect5"><a href="#idm140495282021968">9.8.2.1.2. Mount SD-Card</a></span></dt></dl></dd><dt><span class="sect4"><a href="#idm140495282014928">9.8.2.2. Download images from TFTP Server</a></span></dt></dl></dd><dt><span class="sect3"><a href="#idm140495282002928">9.8.3. Boot via NAND</a></span></dt><dt><span class="sect3"><a href="#idm140495282002640">9.8.4. Boot via TFTP and NFS</a></span></dt><dd><dl><dt><span class="sect4"><a href="#idm140495281996352">9.8.4.1. Copy init files to the Target </a></span></dt><dt><span class="sect4"><a href="#idm140495281989504">9.8.4.2. Setup barebox config to boot via tftp and nfs </a></span></dt><dt><span class="sect4"><a href="#idm140495281987648">9.8.4.3. Prepare kernel and rootfs for boot via TFTP and NFS </a></span></dt><dt><span class="sect4"><a href="#idm140495281987520">9.8.4.4. Switching between booting from NAND and via TFTP and NFS</a></span></dt></dl></dd><dt><span class="sect3"><a href="#idm140495281973248">9.8.5. Boot the board</a></span></dt><dt><span class="sect3"><a href="#idm140495281972992">9.8.6. Summary</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="#idm140495282309888">10. Test or Debug</a></span></dt><dt><span class="sect1"><a href="#idm140495281944144">11. Version Control with Git</a></span></dt><dd><dl><dt><span class="sect2"><a href="#idm140495281931168">11.1. Create environment setup files</a></span></dt><dt><span class="sect2"><a href="#idm140495281930912">11.2. Start Tools with GUI for Repositories</a></span></dt><dt><span class="sect2"><a href="#idm140495281925152">11.3. Show and Check Repositories</a></span></dt><dt><span class="sect2"><a href="#idm140495281905648">11.4. Summary</a></span></dt></dl></dd></dl></div>

<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm140495282579040"></a>1. License</h2></div></div></div>


<p>Author: Jan Kobler, Kobler Systems GmbH, email: eng1@koblersystems.de</p>
<p>This work by <a class="ulink" href="http://www.koblersystems.de" target="_top">Kobler Systems GmbH</a> is licensed under the Creative Commons Attribution 4.0 International License. To view a copy of this license, visit <a class="ulink" href="http://creativecommons.org/licenses/by/4.0/" target="_top">http://creativecommons.org/licenses/by/4.0/</a>.</p>
<p></p>
</div>
<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm140495282575408"></a>2. About this manual</h2></div></div></div>


<p>This manual shows how to </p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<p>install the source code of the Linux BSP for phyBOARD-WEGA-AM335x on the host, </p></li><li class="listitem">
<p>build it, </p></li><li class="listitem">
<p>install the resulting images on the target and </p></li><li class="listitem">
<p>start Linux on the target. </p></li></ul></div>

<p>It is possible to boot the target </p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<p>from NAND or</p></li><li class="listitem">
<p>from SD-card</p></li></ul></div>

<p>It is possible to load the kernel and the rootfs </p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<p>from NAND,</p></li><li class="listitem">
<p>from SD-card or</p></li><li class="listitem">
<p>via TFTP and NFS</p></li></ul></div>

<p>This BSP is for use with:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<p>phyBOARD-WEGA-AM335x with carrier board 1405.0 or 1405.1</p></li><li class="listitem">
<p>HDMI Adapter PEB-AV-01 1406.0 or 1406.1</p></li><li class="listitem">
<p>Eval Module PEB-EVAL-01 1413.0 or 1413.1</p></li></ul></div>

<p>This tutorial and the accompanying makefiles for this BSP have been tested on:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<p>phyBOARD-WEGA-AM335x with carrier board 1405.1</p></li><li class="listitem">
<p>HDMI Adapter PEB-AV-01 1406.1</p></li><li class="listitem">
<p>Eval Module PEB-EVAL-01 1413.1</p></li></ul></div>

<p>Some parts of this tutorial are repeated at places where there are needed, to avoid jumping back in the text, when following the instructions. </p>
<p>There are similar chapters in this text, because they describe the commands for a <span class="emphasis"><em>quick start</em></span> or for <span class="emphasis"><em>development</em></span> or usage of the commands for the <span class="emphasis"><em>first time</em></span> or usage of the commands <span class="emphasis"><em>again</em></span>.</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<p>When you want to use only the necessary commands, follow the instructions in the <a class="link" href="#Quick_Start_Source_1" title="8. Quick Start: Use the Source Code of Phytec Linux Without Changing It">quick start</a> chapter. </p></li><li class="listitem">
<p>When you want to use all commands or want to change the source code, then start with the <a class="link" href="#Develop_Source_1" title="9. Development: Use and Change the Source Code of Phytec Linux">development</a> chapter and skip the <span class="emphasis"><em>quick start</em></span> and <span class="emphasis"><em>again</em></span> chapters.</p></li><li class="listitem">
<p>When you want to use the commands again, then follow the instructions in the <a class="link" href="#Develop_Source_1" title="9. Development: Use and Change the Source Code of Phytec Linux">development</a> chapter and skip the <span class="emphasis"><em>first time</em></span> chapters.</p></li></ul></div>

<p>At first this might seem to be confusing, but in the long run it saves time, when regularly using this tutorial and the accompanying makefiles. </p>
<p>The commands used in this document are shown in the following graph.</p>
<p>The meaning of the node shapes and arrows in this graph is:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<p>grey circle: state of the development environment or action on the target</p></li><li class="listitem">
<p>ellipse: makefile targets in makefile <code class="code">${BSP_MK}</code> or some other command</p></li><li class="listitem">
<p>solid arrow: next step</p></li><li class="listitem">
<p>dashed arrow from A to B: B depends on A</p></li></ul></div>
<div class="figure"><a name="fig_svg"></a><p class="title"><b>Figure 1. Workflow of the development process</b></p><div class="figure-contents">
    
    <div class="mediaobject"><img src="install_pd_src.svg" alt="Workflow of the development process"></div>
</div></div><br class="figure-break">


<p>The commands used to manage the version control in this document and the resulting dataflow are shown in the following graph.</p>
<p>The meaning of the node shapes and arrows in this graph is:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<p>grey octagon: git repository</p></li><li class="listitem">
<p>light blue octagon: single file or folder</p></li><li class="listitem">
<p>box: makefile targets in makefile <code class="code">${BSP_MK}</code></p></li><li class="listitem">
<p>inverted house: single command</p></li><li class="listitem">
<p>solid arrow: data flow</p></li><li class="listitem">
<p>dashed arrow from A to B: The makefile target A uses the command B</p></li></ul></div>
<div class="figure"><a name="fig_svg"></a><p class="title"><b>Figure 2. Version control dataflow</b></p><div class="figure-contents">
    
    <div class="mediaobject"><img src="install_pd_src_git.svg" alt="Version control dataflow"></div>
</div></div><br class="figure-break">

</div>
<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm140495282574448"></a>3. Folder, Filenames and Macros</h2></div></div></div>


<p>Folders:</p>

<p>Folder for Phytec Linux software: <code class="code">${MY_DEVELOP}</code></p>

<p>Folder for current software distribution: <code class="code">${DISTRIB_IN}</code></p>
<p>Filenames:</p>

<p>makefile: <code class="code">${BSP_MK}</code></p>
<p>Macros: </p>

<p>Version Identifier <code class="code">${MY_VERSION}</code></p>
</div>
<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm140495282491824"></a>4. Environment</h2></div></div></div>


<p>Define environment variables:</p>
<pre class="screen">
export MY_VERSION=20141113-1
export MY_DEVELOP=/MyDevelop/phyBOARD-WEGA-AM335x
export DISTRIB_IN=${MY_DEVELOP}/distrib/test-${MY_VERSION}</pre>

<p>Please adjust the value of <code class="code">MY_DEVELOP</code> to your needs. Use the same value also in the makefile <code class="code">${BSP_MK}</code>. </p>
</div>
<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm140495282488976"></a>5. Install Software on the host</h2></div></div></div>


<p>This section describes how to install Phytec and third party software on the host. </p>
<p>The commands in this tutorial have been tested on a system running <a class="ulink" href="http://www.gentoo.org" target="_top">Gentoo Linux</a>. Most commands should be the same on other Linux systems.</p>
<p></p>
<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="idm140495282486512"></a>5.1. Install third party software on the host</h3></div></div></div>


<p>For building the Linux BSP from source you need the tools: <code class="code">wget, expect, sudo, fakeroot</code></p>

<p>On Gentoo Linux you can install these tools with</p>
<pre class="screen">
emerge --ask -v wget expect sudo fakeroot</pre>

<p><code class="code">emerge</code> is a Gentoo specific command for installing software.</p>
<p>For testing and using the Linux BSP on a Phytec phyBOARD-WEGA-AM335x board you need the utilities: <code class="code">tftp, nfs, minicom, taylor-uucp</code></p>

<p>You can install these tools with</p>

<pre class="screen">
emerge --ask -v tftp-hpa nfs-utils minicom taylor-uucp</pre>

<p>For working with git repositories you need: <code class="code">git</code></p>
<p>If you want to use the GUI of git you need also: <code class="code">git gui, gitk</code></p>
<p><code class="code">nano</code> is used as editor. </p>
<p>You need a TFTP server on your host system for installing the binary images on the target and boot from NAND. </p>
<p>You need a NFS and TFTP server on your host system for <a class="link" href="#Boot_via_TFTP_and_NFS" title="9.7.4. Boot via TFTP and NFS">Boot_via_TFTP_and_NFS</a></p>
<p><code class="code">make</code> is usally used in the commands in this manual. </p>
<p>Install missing software on the host. </p>
</div>
<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="idm140495282486256"></a>5.2. Install Phytec software on the host</h3></div></div></div>


<p>Phytec software for Linux for phyBOARD-WEGA-AM335x is shipped in several parts. The first part is shipped  as git bundle. </p>
<p>Please install the software into the folder <code class="code">${DISTRIB_IN}</code></p>
<pre class="screen">
mkdir -p $(dirname ${DISTRIB_IN}/bundles/phyBOARD-WEGA-AM335x-phytec-linux-install.bundle)  &amp;&amp; \
wget -O ${DISTRIB_IN}/bundles/phyBOARD-WEGA-AM335x-phytec-linux-install.bundle http://www.koblersystems.de/bsp-doc/bundles/phyBOARD-WEGA-AM335x-phytec-linux-install.bundle; 
mkdir -p ${DISTRIB_IN}/install
git clone --branch phyBOARD-WEGA-13.0.0-01 ${DISTRIB_IN}/bundles/phyBOARD-WEGA-AM335x-phytec-linux-install.bundle ${DISTRIB_IN}/install</pre>

<p>So far only a small part of the software has been installed into the folder <code class="code">${DISTRIB_IN}</code>. The rest of the Phytec software is downloaded later. </p>
</div>
</div>
<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm140495282474176"></a>6. Barebox configuration</h2></div></div></div>


<p>This section describes how to edit the config files of the bootloader barebox on the target and how to return to the default environment.</p>
<p>When you follow the instructions in this manual, you usually don't need to edit files on the target, because the files are edited instead on the host and downloaded via tftp to the target. </p>
<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="idm140495282472224"></a>6.1. Edit barebox files on the target</h3></div></div></div>


<p>When you need to edit a file on the target e.g. <code class="code">/env/network/eth0</code>, you can use the command <code class="code">edit</code></p>
<pre class="screen">
edit /env/network/eth0</pre>

<p>Save the file with CTRL-D or close the file without saving by pressing CTRL-C.</p>
<p>Save changes</p>
<pre class="screen">
saveenv</pre>
</div>
<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="idm140495282469744"></a>6.2. Default settings</h3></div></div></div>


<p>When you want to return to the default settings, erase all your changes.</p>
<pre class="screen">
erase /dev/nand0.bareboxenv</pre>
</div>
</div>
<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm140495282468208"></a>7. Makefile</h2></div></div></div>


<p>The makefile <code class="code">${BSP_MK}</code> contains the code to install and use Phytec Linux for phyBOARD-WEGA-AM335x. </p>
<p>Define environment variable:</p>
<pre class="screen">
export BSP_MK=${DISTRIB_IN}/install/scripts/pd_src.mk</pre>

<p>Define alias <code class="code">bmk </code> for the make command:</p>
<pre class="screen">
alias bmk="make --makefile ${BSP_MK} -C $(dirname ${BSP_MK})"</pre>

<p>Before using the makefile, you need to set some variables in it</p>
<pre class="screen">
nano ${BSP_MK}</pre>

<p>Especially set the value of <code class="code">${MY_DEVELOP}</code> to the same value you have already defined in the environment. </p>
<p>New or changed content of file <code class="code">${BSP_MK}</code>:</p>
<pre class="screen">

#################################################
# User specific settings
# Please set the variables below this line
#################################################

# Set the root folder for the Phytec Linux BSP software
# most of the files and directories are installed or created in this folder or subfolders.
MY_DEVELOP:=/MyDevelop/phyBOARD-WEGA-AM335x

# current version number
MY_VERSION:=20141113-1

# VERY IMPORTANT: This is the device name of the SD-card on the host, when it is inserted in the card reader.
# This device will be ERASED and FORMATTED!!!
# Don't select a disk of your host, otherwise it will be erased !!
# You can use 'dmesg' to find out the device name, after the SD-card has been inserted in the card reader.
# If you don't know the device name use /dev/null
SDCARD_DEV:=/dev/null
# This is the prefix of the partition name: usally it is the same as $(SDCARD_DEV)
# but sometimes its value is '$(SDCARD_DEV)p'.
SDCARD_PART:=$(SDCARD_DEV)

# The distribution archive has been extracted into this folder
DISTRIB_IN:=$(MY_DEVELOP)/distrib/test-$(MY_VERSION)

# Please set the download folder for software archives, which can be shared with other development environments.
MY_DOWNLOAD_SRC:=/MyDevelop/distfiles

# Download folder for archives which are specific to this board
MY_DOWNLOAD_BOARD:=/MyDownload/phyBOARD-WEGA-AM335x

# Install the toolchain into this folder, i.e. the compiler is installed in this folder. 
MY_TOOLCHAIN:=$(MY_DEVELOP)/toolchain

# Please set folder of the tftp server
MY_TFTPBOOT:=/tftpboot

# Please set the IP addresses of your host and the target.
IP_ADDR_TARGET:=192.168.1.8
IP_ADDR_HOST:=192.168.1.32
IP_NETMASK:=255.255.255.0
IP_ADDR_GATEWAY:=192.168.1.1

# This client address is used in the file /etc/exports
IP_NFS_CLIENT:=192.168.1.255/24

# Folder for the  local git repositories. This folder may be shared by several projects. 
LOCAL_GIT:=$(MY_DEVELOP)/git-PD

# Folder for the makefiles which are included at the end of this file. 
# If you move this file into another folder, you can define the include directory for the makefiles. 
# Default value is the current working directory. 
MY_SCRIPTS:=.

#################################################
#
#              Git Repositories 
#
# For the first tests you don't need to change the following values. 
#
# Only when you change the source code of the BSP
# and save the changes in git repositories 
# you need to adjust the following values as needed 
#
# The values are used in pd_src_git.mk. 
# Please search there for these macros before you change them. 
#
# Revision names or commit ids or start numbers for git repositories
# GIT_REV_NAME_*: 	git branch or tag name
# GIT_REV_ID_*: 	git commit id
# GIT_START_NUMBER_*: 	git start number of patch numbers
#
#################################################

GIT_REV_NAME_bsp:=master
GIT_REV_ID_bsp:=fb5de7ae1f61a84793bbc4d5fc5c66ec9eccd49b
GIT_REV_NAME_ptxdist:=master
GIT_REV_ID_ptxdist:=d72665bd5e4565c6793f78ae99e6e22113faed0f
GIT_REV_NAME_barebox:=master
GIT_REV_ID_barebox:=0000000
GIT_REV_ID_barebox_start:=0000000
GIT_START_NUMBER_barebox:=20
GIT_REV_NAME_linux:=master
GIT_REV_ID_linux:=00000000
GIT_REV_ID_linux_start:=00000000
GIT_START_NUMBER_linux:=120
GIT_REV_NAME_toolchain:=master
GIT_REV_ID_toolchain:=90a8fe685cb903b4cf2b668be54029d3524207b2
GIT_REV_NAME_gcc-linaro:=master
GIT_REV_ID_gcc-linaro:=00000000
GIT_REV_ID_gcc-linaro_start:=000000000
GIT_START_NUMBER_gcc-linaro:=400
GIT_REV_NAME_tftpboot:=phyBOARD-WEGA-13.0.0-01
GIT_REV_ID_tftpboot:=7f123cdf7aa7a2a4a2a58af3edfcd7c11b5541ae

#################################################
# No need to change the variables below this line
#################################################</pre>

<p><span class="strong"><strong>Note: </strong></span>All needed variables are defined inside the makefile. No specific environment variable needs to be defined outside the makefile. </p>

<p>Both commands list the available make targets</p>
<pre class="screen">
bmk 
bmk info_target</pre>

<p>Before you make a target, you can check which commands will be used by using the option <code class="code">-n</code>. </p>
<pre class="screen">
bmk doc_download -n</pre>

<p><span class="strong"><strong>Note: </strong></span>It is important to check which commands are used to avoid any damage to your computer system. </p>

<p>When some of the make targets are succesfully made, then a state file is created for each target in the folder <code class="code">$(STATE)</code>. These targets are again made only, when there is no state file. You can remove such a state file by using a target name, which is the old target name with the prefix <code class="code">rm_</code>. Make e.g. the target <code class="code">doc_download</code></p>
<pre class="screen">
bmk doc_download -n
bmk doc_download</pre>

<p>List the target states. </p>
<pre class="screen">
bmk list_states</pre>

<p>Before you can make the target <code class="code">doc_download</code> again, you have to remove the correspondig state file by making the target <code class="code">rm_doc_download</code>. </p>
<pre class="screen">
bmk rm_doc_download
bmk doc_download</pre>

<p>The intention of the makefile <code class="code">${BSP_MK}</code> is to show or execute the correct commands, which are needed to install and use the software Phytec Linux for phyBOARD-WEGA-AM335x. It is important, that the user understands, what the commands like <code class="code">ptxdist</code> are doing. This manual tries to show how to use these commands in the correct sequence. </p>
<p>The makefile is not intended to replace any existing tool. Feel free to create your own scripts, makefiles or call the resulting commands directly. </p>
<p>Changes in config files are often achieved by using the stream editor <code class="code">sed</code>. The scripts for the stream editor search for specific patterns in the config files. Be careful when changing the config files yourself.</p>
</div>
<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Quick_Start_Source_1"></a>8. Quick Start: Use the Source Code of Phytec Linux Without Changing It</h2></div></div></div>


<p>If you want to get quickly up and running, </p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<p>follow first the instructions from the beginning of this document until this chapter </p></li><li class="listitem">
<p>and then the instructions in this chapter. </p></li></ul></div>

<p>In this chapter only the commands are shown, which are needed </p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<p>to install the tools, </p></li><li class="listitem">
<p>to build the BSP, </p></li><li class="listitem">
<p>to install the images on the target and </p></li><li class="listitem">
<p>to boot the target from different sources</p></li></ul></div>

<p>for the first time. </p>
<p>In other parts of this document more commands are shown, which can help you with working with the BSP and developing software. Also if you run into problems when executing the commands in this quick start chapter, you should find some solutions in the rest of this document. </p>
<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="idm140495282439248"></a>8.1. Install Tools and BSP</h3></div></div></div>

<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="idm140495282438608"></a>8.1.1. Install Tools and BSP for Phytec Linux - First Time</h4></div></div></div>


<p>This chapter shows how to install the tool ptxdist, the toolchain and the BSP on the host.</p>
<div class="sect4"><div class="titlepage"><div><div><h5 class="title"><a name="idm140495282437296"></a>8.1.1.1. Download Docs</h5></div></div></div>


<p>download docs for bsp</p>
<pre class="screen">
bmk doc_download</pre>
</div>
<div class="sect4"><div class="titlepage"><div><div><h5 class="title"><a name="idm140495282435760"></a>8.1.1.2. Ptxdist</h5></div></div></div>


<p>download files for ptxdist</p>
<pre class="screen">
bmk ptxdist_download</pre>

<p>Extract ptxdist</p>
<pre class="screen">
bmk ptxdist_extract</pre>

<p>Install ptxdist</p>
<pre class="screen">
bmk ptxdist_install</pre>

<p>Select <code class="code">${MY_DOWNLOAD_SRC}</code> as common source directory, where all the archives are downloaded, only missing archives are downloaded. All archives which will be downloaded when building the toolchain or the bsp are downloaded in this folder. </p>
<pre class="screen">
bmk ptxdist_setup_srcdir</pre>
</div>
<div class="sect4"><div class="titlepage"><div><div><h5 class="title"><a name="idm140495282431264"></a>8.1.1.3. Toolchain</h5></div></div></div>


<p>download files for toolchain</p>
<pre class="screen">
bmk toolchain_download</pre>

<p>Extract Toolchain</p>
<pre class="screen">
bmk toolchain_extract</pre>

<p>This describes the usage of <code class="code">ptxdist</code> for building the toolchain. You don't need to call any of the commands, which are shown in the output, to install the toolchain right now. If you run into problems building the toolchain, you will need to call ptxdist directly. At the moment the output is only for your info: </p>
<pre class="screen">
bmk toolchain_ptxdist</pre>

<p>Set prefix for toolchain folder. The default is /opt. Here a local folder is selected in order not to interfere with other toolchains. </p>
<pre class="screen">
bmk toolchain_prefix</pre>

<p>select the toolchain</p>
<pre class="screen">
bmk toolchain_select</pre>

<p>migrate the config file to a new ptxdist version</p>
<pre class="screen">
bmk toolchain_migrate</pre>

<p>check PTXCONF_SETUP_SRCDIR in ptxdistrc for toolchain</p>
<pre class="screen">
bmk toolchain_check_srcdir</pre>

<p>build the toolchain from scratch</p>
<pre class="screen">
bmk toolchain_build</pre>

<p>remove temporary files of toolchain in order to save disk space</p>
<pre class="screen">
bmk toolchain_clean_build</pre>
</div>
<div class="sect4"><div class="titlepage"><div><div><h5 class="title"><a name="idm140495282430944"></a>8.1.1.4. BSP</h5></div></div></div>


<p>download files for bsp</p>
<pre class="screen">
bmk bsp_download</pre>

<p>Preparations for installing the BSP</p>
<pre class="screen">
bmk bsp_prepare</pre>

<p>Extract BSP</p>
<pre class="screen">
bmk bsp_extract</pre>

<p>Select the configuration files</p>
<pre class="screen">
bmk bsp_config</pre>

<p>The compiler is searched in the /opt folder. If it is found a link is created. Select the compiler, which you have just built. </p>
<pre class="screen">
bmk bsp_compiler</pre>

<p>Check PTXCONF_SETUP_SRCDIR in ptxdistrc for bsp</p>
<pre class="screen">
bmk bsp_check_srcdir</pre>
</div>
<div class="sect4"><div class="titlepage"><div><div><h5 class="title"><a name="idm140495282421728"></a>8.1.1.5. Barebox environment for tftpboot folder</h5></div></div></div>


<p>Download bundle of tftpboot_local</p>
<pre class="screen">
bmk download_bundle_git_tftpboot_local</pre>

<p>Create repository of local repository of tftpboot</p>
<pre class="screen">
bmk create_git_tftpboot_local</pre>

<p>Create new git work repository of current tftpboot and checkout files in new source folder for existing local repositories </p>
<pre class="screen">
bmk create_co_git_tftpboot_work</pre>

<p>cp env into images. Copy the prepared tftpboot files into the images folder</p>
<pre class="screen">
bmk archive_barebox_env</pre>
</div>
<div class="sect4"><div class="titlepage"><div><div><h5 class="title"><a name="idm140495282415216"></a>8.1.1.6. Summary</h5></div></div></div>


<p>Install Tools and BSP</p>
<pre class="screen">
bmk  \
	doc_download \
	ptxdist_download \
	ptxdist_extract \
	ptxdist_install \
	ptxdist_setup_srcdir \
	toolchain_download \
	toolchain_extract \
	toolchain_ptxdist \
	toolchain_prefix \
	toolchain_select \
	toolchain_migrate \
	toolchain_check_srcdir \
	toolchain_build \
	toolchain_clean_build \
	bsp_download \
	bsp_prepare \
	bsp_extract \
	bsp_config \
	bsp_compiler \
	bsp_check_srcdir \
	download_bundle_git_tftpboot_local \
	create_git_tftpboot_local \
	create_co_git_tftpboot_work \
	archive_barebox_env</pre>
</div>
</div>
</div>
<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="idm140495282408128"></a>8.2. Build BSP for Phytec Linux - First Time</h3></div></div></div>


<p>This chapter shows how to build the BSP on the host.</p>
<p>Build BSP with ptxdist </p>
<pre class="screen">
bmk bsp_go</pre>

<p>At the end you get the message: </p>

<p>Output:</p>
<pre class="screen">
-------------------------------------------------------------------
For a proper NFS-root environment, some device nodes are essential.
In order to create them root privileges are required.
-------------------------------------------------------------------

(Please press enter to start 'sudo' to gain root privileges.)


WARNING: NFS-root might not be working correctly!</pre>

<p>If you missed it you can build the bsp again with:</p>
<pre class="screen">
bmk rm_bsp_go
bmk bsp_go</pre>

<p>Output:</p>
<pre class="screen">
-------------------------------------------------------------------
For a proper NFS-root environment, some device nodes are essential.
In order to create them root privileges are required.
-------------------------------------------------------------------

(Please press enter to start 'sudo' to gain root privileges.)</pre>

<p>Press enter.</p>
<p>Output:</p>
<pre class="screen">
Password: </pre>

<p>Enter the root password. Output:</p>
<pre class="screen">
creating device node: platform-phyBOARD-WEGA-AM335x/root/dev/null
creating device node: platform-phyBOARD-WEGA-AM335x/root/dev/zero
creating device node: platform-phyBOARD-WEGA-AM335x/root/dev/console
creating device node: platform-phyBOARD-WEGA-AM335x/root-debug/dev/null
creating device node: platform-phyBOARD-WEGA-AM335x/root-debug/dev/zero
creating device node: platform-phyBOARD-WEGA-AM335x/root-debug/dev/console</pre>

<p>Create images for BSP with ptxdist </p>
<pre class="screen">
bmk bsp_images</pre>

<p>All binaries for the target have been created now. </p>
</div>
<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="idm140495282407968"></a>8.3. Use Binary Versions of Phytec Linux - First Time</h3></div></div></div>


<p>This chapter shows how to download the binary images of the bootloader, Linux kernel and the root file system and boot the device in different ways. </p>
<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="idm140495282396592"></a>8.3.1. Create Archives of Filesystems and Install  Phytec Linux BSP on SD-Card for boot_mmc</h4></div></div></div>


<p>Save barebox image, kernel image and device tree in image folder. </p>
<pre class="screen">
bmk kernel_01</pre>

<p>overwrite image area on SD-card with zeros , format SD-card, create binary image</p>
<pre class="screen">
bmk  parted_sdcard_01 cp_archive_sdcard_01 cp_file_sdcard_01</pre>
</div>
<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="idm140495282393568"></a>8.3.2. Update Bootloader in NAND</h4></div></div></div>


<p>You can update the bootloader in NAND:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<p>by copying the images from SD-Card or </p></li><li class="listitem">
<p>by downloading the images from an TFTP server. </p></li></ul></div>
<div class="sect4"><div class="titlepage"><div><div><h5 class="title"><a name="idm140495282390160"></a>8.3.2.1. Use images from SD-Card</h5></div></div></div>


<p>You can copy the images from an SD-card :</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<p>after booting from the SD-Card or</p></li><li class="listitem">
<p>after mounting the SD-Card manually. </p></li></ul></div>
<div class="sect5"><div class="titlepage"><div><div><h6 class="title"><a name="idm140495282386752"></a>8.3.2.1.1. Boot from SD-Card</h6></div></div></div>


<p>When you boot from SD-card, the card is already mounted at /boot.</p>

<p>Check which devices are known</p>
<pre class="screen">
devinfo</pre>

<p>Check which images are on the SD-card</p>
<pre class="screen">
ls /boot</pre>

<p>Output:</p>
<pre class="screen">
MLO            barebox.bin    barebox.env    linuximage    </pre>

<p>Update x-loader MLO</p>
<pre class="screen">
erase /dev/nand0.xload.bb
cp /boot/MLO /dev/nand0.xload.bb</pre>

<p>Update barebox</p>
<pre class="screen">
erase /dev/nand0.barebox.bb
cp /boot/barebox.bin /dev/nand0.barebox.bb</pre>

<p>When the bootloader has changed significantly, it is also necessary to erase the barebox environment:</p>
<pre class="screen">
erase /dev/nand0.bareboxenv</pre>
</div>
<div class="sect5"><div class="titlepage"><div><div><h6 class="title"><a name="idm140495282386496"></a>8.3.2.1.2. Mount SD-Card</h6></div></div></div>


<p>Further information is available in L-775e_3.pdf on page 22. </p>

<p>Insert SD-Card and mount it. </p>

<p>Check which devices are known</p>
<pre class="screen">
devinfo</pre>

<p>Mount the SD-card, if it is not already mounted:</p>
<pre class="screen">
mci0.probe=1
ls /mnt
mkdir /mnt/disk
mount /dev/disk0.0 /mnt/disk</pre>

<p>Check which images are on the SD-card</p>
<pre class="screen">
ls /mnt/disk</pre>

<p>Output:</p>
<pre class="screen">
MLO            barebox.bin    linuximage    </pre>

<p>Update x-loader MLO</p>
<pre class="screen">
erase /dev/nand0.xload.bb
cp /mnt/disk/MLO /dev/nand0.xload.bb</pre>

<p>Update barebox</p>
<pre class="screen">
erase /dev/nand0.barebox.bb
cp /mnt/disk/barebox.bin /dev/nand0.barebox.bb</pre>

<p>When the bootloader has changed significantly, it is also necessary to erase the barebox environment:</p>
<pre class="screen">
erase /dev/nand0.bareboxenv</pre>
</div>
</div>
<div class="sect4"><div class="titlepage"><div><div><h5 class="title"><a name="idm140495282379360"></a>8.3.2.2. Download images from TFTP Server</h5></div></div></div>


<p>Copy barebox image of boot_nand into images folder</p>
<pre class="screen">
bmk cp_barebox_boot_nand</pre>

<p>Copy barebox from images folder into tftp folder</p>
<pre class="screen">
bmk tftpboot_barebox</pre>

<p>Update barebox via TFTP</p>
<pre class="screen">
bmk update_barebox</pre>
</div>
</div>
<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="idm140495282367632"></a>8.3.3. Boot via NAND</h4></div></div></div>


<p>copy kernel image for boot_tftp_nfs and boot_nand into images folder</p>
<pre class="screen">
bmk kernel_boot_tftp_nfs</pre>

<p>Copy kernel into tftp folder</p>
<pre class="screen">
bmk tftpboot_kernel</pre>

<p>Copy the ubi image of boot_nand</p>
<pre class="screen">
bmk cp_image_boot_nand</pre>

<p>Copy root.ubi into tftp folder</p>
<pre class="screen">
bmk tftpboot_root_ubi</pre>

<p>Update kernel and root on target for boot_nand</p>
<pre class="screen">
bmk update_target_boot_nand</pre>
</div>
<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="idm140495282367312"></a>8.3.4. Boot via TFTP and NFS</h4></div></div></div>

<div class="sect4"><div class="titlepage"><div><div><h5 class="title"><a name="idm140495282361280"></a>8.3.4.1. Prepare tftp config</h5></div></div></div>


<p>cp env into images. Copy the prepared tftpboot files into the images folder</p>
<pre class="screen">
bmk archive_barebox_env</pre>

<p>Barebox config files are copied into the real folder tftpboot, which is used by the tftp server. Do it only once. Default settings are to boot from NAND. </p>
<pre class="screen">
bmk cp_barebox_config</pre>

<p>Because the config files contain dummy ip addresses, it is important to set the correct ip addresses.</p>
<pre class="screen">
bmk set_ip_barebox_config</pre>
</div>
<div class="sect4"><div class="titlepage"><div><div><h5 class="title"><a name="idm140495282357456"></a>8.3.4.2. Copy init files to the Target </h5></div></div></div>


<p>Copy <code class="code">env/boot/net-02</code> and some other files to the target.</p>
<pre class="screen">
bmk cp_init_board</pre>

<p>The output of this make command describes how to download files to the target. Follow the instructions.</p>
<p>When barebox is restarted, <code class="code">/env/network/eth0</code> is used to configure the Ethernet port. When you call </p>
<pre class="screen">
boot net-02</pre>

<p> you can boot the board via TFTP and NFS. The file <code class="code">/env/boot/net-02</code> is executed and loads the file <code class="code">/env/bin/net-03</code> from the TFTP server. This file is also executed. </p>
<p><span class="strong"><strong>Note: </strong></span>It is very important that you copy the init files to the target. Some commands in the makefile are changing the config file in the tftpboot folder on the host.</p>
</div>
<div class="sect4"><div class="titlepage"><div><div><h5 class="title"><a name="idm140495282350368"></a>8.3.4.3. Setup barebox config to boot via tftp and nfs </h5></div></div></div>


<p>Adjust boot.default in env/config to boot from TFTP and NFS</p>
<pre class="screen">
bmk tftpboot_config_loc_boot_tftp_nfs</pre>
</div>
<div class="sect4"><div class="titlepage"><div><div><h5 class="title"><a name="idm140495282348512"></a>8.3.4.4. Prepare kernel and rootfs for boot via TFTP and NFS </h5></div></div></div>


<p>Build BSP with ptxdist </p>
<pre class="screen">
bmk bsp_go</pre>

<p>Create images for BSP with ptxdist </p>
<pre class="screen">
bmk bsp_images</pre>

<p>copy kernel image for boot_tftp_nfs into images folder</p>
<pre class="screen">
bmk kernel_boot_tftp_nfs</pre>

<p>Copy kernel from images into tftp folder</p>
<pre class="screen">
bmk tftpboot_kernel</pre>

<p>Copy RootFS Archive of boot_tftp_nfs into images</p>
<pre class="screen">
bmk cp_image_boot_tftp_nfs</pre>

<p>Create root file system, which can be mounted via NFS. </p>
<pre class="screen">
bmk create_rootfs_boot_tftp_nfs</pre>

<p>Setup NFS, add rootfs to /etc/exports</p>
<pre class="screen">
bmk export_rootfs</pre>

<p>exportfs -r</p>
<pre class="screen">
bmk export_refresh</pre>

<p>remove fingerprint in .ssh/known_hosts</p>
<pre class="screen">
bmk ssh_fingerprint</pre>

<p>Adjust nfsroot in env/config</p>
<pre class="screen">
bmk tftpboot_config</pre>

<p>show command for netconsole</p>
<pre class="screen">
bmk netconsole</pre>
</div>
<div class="sect4"><div class="titlepage"><div><div><h5 class="title"><a name="idm140495282348224"></a>8.3.4.5. Switching between booting from NAND and via TFTP and NFS</h5></div></div></div>


<p>You have just configured the board to boot via TFTP and NFS. If you want to switch back to booting from NAND, you can use the following command. </p>
<p>Adjust boot.default in env/config to boot from NAND</p>
<pre class="screen">
bmk tftpboot_config_loc_boot_nand</pre>

<p>If you want to switch again to booting via TFTP and NFS, you can use again the following command. </p>
<p>Adjust boot.default in env/config to boot from TFTP and NFS</p>
<pre class="screen">
bmk rm_tftpboot_config_loc_boot_tftp_nfs
bmk tftpboot_config_loc_boot_tftp_nfs</pre>
</div>
</div>
<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="idm140495282333664"></a>8.3.5. Boot the board</h4></div></div></div>


<p>Check if you have the correct hardware versions:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<p>phyBOARD-WEGA-AM335x with carrier board 1405.0 or 1405.1</p></li><li class="listitem">
<p>HDMI Adapter PEB-AV-01 1406.0 or 1406.1</p></li><li class="listitem">
<p>Eval Module PEB-EVAL-01 1413.0 or 1413.1</p></li></ul></div>

<p>By default the board tries to boot from NAND at first. Without any valid bootloader in NAND, the board will try to boot from SD-card next.</p>
<p>You can force the board to try to boot from SD-card at first. This allows you to test the bootloader on the SD-card without changing anything in NAND.</p>
<p>If you have the carrier board 1405.0:</p>

<p>You can force the board to boot from SD-card by connecting X_LCD_D2 (pin 8 at X70) to a high-level (e.g. VCC3V3 &#8211; pin13 at X71) during the power-up sequence.</p>
<p>If you have the carrier board 1405.1: </p>

<p>Take off the expansion board PEB-AV-01 or PEB-AV-02. Move the DIP switch to ON, to force booting from SD-card. When you have moved the switch in direction of the SD-card slot, the switch is in position ON. </p>
<p>The description how to boot from SD-card can be found in L-792e_0.pdf on page 77 and in <a class="ulink" href="http://www.phytec.de/de/support/faq/faq-phyboard-wega.html" target="_top">http://www.phytec.de/de/support/faq/faq-phyboard-wega.html</a>. </p>
<p>Connect the board to the host, network and display: </p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<p>Connect a serial cable (one-to-one) to the DB9 connector on PEB-EVAL-01. Set the speed to 115200 8N1 in your terminal application on the host. </p></li><li class="listitem">
<p>Connect an ethernet cable to the port X16 on the carrier board. This is the ethernet port next to the USB port. </p></li><li class="listitem">
<p>If you want to work with an SD-card, insert the SD-card into carrier board. </p></li><li class="listitem">
<p>You can connect also a display to the HDMI port on PEB-AV-01. </p></li></ul></div>

<p>Boot the board again. </p>
</div>
<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="idm140495282333408"></a>8.3.6. Summary</h4></div></div></div>


<p>Create images for SD-card</p>
<pre class="screen">
bmk  \
	kernel_01 \
	parted_sdcard_01 \
	cp_archive_sdcard_01 \
	cp_file_sdcard_01</pre>

<p>update barebox, kernel and root file system in NAND</p>
<pre class="screen">
bmk  \
	cp_barebox_boot_nand \
	tftpboot_barebox \
	update_barebox \
	cp_image_boot_nand \
	tftpboot_root_ubi \
	kernel_boot_tftp_nfs \
	tftpboot_kernel \
	update_target_boot_nand</pre>

<p>update kernel and root file system in NAND</p>
<pre class="screen">
bmk  \
	cp_image_boot_nand \
	tftpboot_root_ubi \
	kernel_boot_tftp_nfs \
	tftpboot_kernel \
	update_target_boot_nand</pre>

<p>Prepare tftp config for boot via tftp and nfs</p>
<pre class="screen">
bmk  \
	archive_barebox_env \
	cp_barebox_config \
	set_ip_barebox_config \
	cp_init_board \
	tftpboot_config_loc_boot_tftp_nfs</pre>

<p>Prepare kernel and rootfs for boot via TFTP and NFS </p>
<pre class="screen">
bmk  \
	bsp_go \
	bsp_images \
	kernel_boot_tftp_nfs \
	cp_image_boot_tftp_nfs \
	tftpboot_kernel \
	create_rootfs_boot_tftp_nfs \
	export_rootfs \
	export_refresh \
	ssh_fingerprint \
	tftpboot_config \
	netconsole</pre>

<p>Switch back to boot from NAND. Adjust boot.default in env/config to boot from NAND</p>
<pre class="screen">
bmk  \
	tftpboot_config_loc_boot_nand</pre>

<p>Switch again to boot via TFTP and NFS. Adjust boot.default in env/config to boot from TFTP and NFS</p>
<pre class="screen">
bmk  \
	rm_tftpboot_config_loc_boot_tftp_nfs
bmk  \
	tftpboot_config_loc_boot_tftp_nfs</pre>
</div>
</div>
<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="idm140495282319808"></a>8.4. Test or Debug</h3></div></div></div>


<p>dmesg over ssh</p>
<pre class="screen">
bmk ssh_dmesg</pre>
</div>
</div>
<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Develop_Source_1"></a>9. Development: Use and Change the Source Code of Phytec Linux</h2></div></div></div>


<p>Install the tools and the BSP and create the binaries from scratch. </p>
<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="idm140495282308624"></a>9.1. Install Tools and BSP for Phytec Linux - First Time</h3></div></div></div>


<p>This chapter shows how to install the tool ptxdist, the toolchain and the BSP on the host.</p>
<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="idm140495282307248"></a>9.1.1. Download Docs</h4></div></div></div>


<p>download docs for bsp</p>
<pre class="screen">
bmk doc_download</pre>
</div>
<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="idm140495282305328"></a>9.1.2. Ptxdist</h4></div></div></div>


<p>download files for ptxdist</p>
<pre class="screen">
bmk ptxdist_download</pre>

<p>Extract ptxdist</p>
<pre class="screen">
bmk ptxdist_extract</pre>

<p>This creates a new and empty local repository for ptxdist, if it doesn't exist already. </p>
<pre class="screen">
bmk create_new_git_ptxdist_local</pre>

<p>Create new repository of current ptxdist and add source code to it. This creates a new work repository, adds the current source code to it and pushes it to the local repository. </p>
<pre class="screen">
bmk create_new_git_ptxdist_work</pre>

<p>Push changes in  ptxdist_work to local repository. If you have changed the work repository, push changes to the local repository. When you have just extracted the archive i.e. you have not done any changes, you can skip this command.</p>
<pre class="screen">
bmk push_git_ptxdist_work</pre>

<p>Install ptxdist</p>
<pre class="screen">
bmk ptxdist_install</pre>

<p>Select <code class="code">${MY_DOWNLOAD_SRC}</code> as common source directory, where all the archives are downloaded, only missing archives are downloaded. All archives which will be downloaded when building the toolchain or the bsp are downloaded in this folder. </p>
<pre class="screen">
bmk ptxdist_setup_srcdir</pre>
</div>
<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="idm140495282297088"></a>9.1.3. Toolchain</h4></div></div></div>


<p>download files for toolchain</p>
<pre class="screen">
bmk toolchain_download</pre>

<p>Extract Toolchain</p>
<pre class="screen">
bmk toolchain_extract</pre>

<p>This creates a new and empty local repository for toolchain, if it doesn't exist already. </p>
<pre class="screen">
bmk create_new_git_toolchain_local</pre>

<p>Create new repository of current toolchain and add source code to it. This creates a new work repository, adds the current source code to it and pushes it to the local repository. </p>
<pre class="screen">
bmk create_new_git_toolchain_work</pre>

<p>Push changes in  toolchain_work to local repository. If you have changed the work repository, push changes to the local repository. When you have just extracted the archive i.e. you have not done any changes, you can skip this command.</p>
<pre class="screen">
bmk push_git_toolchain_work</pre>

<p>This describes the usage of <code class="code">ptxdist</code> for building the toolchain. You don't need to call any of the commands, which are shown in the output, to install the toolchain right now. If you run into problems building the toolchain, you will need to call ptxdist directly. At the moment the output is only for your info: </p>
<pre class="screen">
bmk toolchain_ptxdist</pre>

<p>Set prefix for toolchain folder. The default is /opt. Here a local folder is selected in order not to interfere with other toolchains. </p>
<pre class="screen">
bmk toolchain_prefix</pre>

<p>select the toolchain</p>
<pre class="screen">
bmk toolchain_select</pre>

<p>migrate the config file to a new ptxdist version</p>
<pre class="screen">
bmk toolchain_migrate</pre>

<p>check PTXCONF_SETUP_SRCDIR in ptxdistrc for toolchain</p>
<pre class="screen">
bmk toolchain_check_srcdir</pre>

<p>build the toolchain from scratch</p>
<pre class="screen">
bmk toolchain_build</pre>

<p>remove temporary files of toolchain in order to save disk space</p>
<pre class="screen">
bmk toolchain_clean_build</pre>
</div>
<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="idm140495282296960"></a>9.1.4. BSP</h4></div></div></div>


<p>download files for bsp</p>
<pre class="screen">
bmk bsp_download</pre>

<p>Preparations for installing the BSP</p>
<pre class="screen">
bmk bsp_prepare</pre>

<p>Extract BSP</p>
<pre class="screen">
bmk bsp_extract</pre>

<p>This creates a new and empty local repository for bsp, if it doesn't exist already. </p>
<pre class="screen">
bmk create_new_git_bsp_local</pre>

<p>Create new repository of current bsp and add source code to it.This creates a new work repository, adds the current source code to it and pushes it to the local repository. </p>
<pre class="screen">
bmk create_new_git_bsp_work</pre>

<p>Push changes in bsp_work to local repository. If you have changed the work repository, push changes to the local repository. When you have just extracted the archive i.e. you have not done any changes, you can skip this command.</p>
<pre class="screen">
bmk push_git_bsp_work</pre>

<p>Select the configuration files</p>
<pre class="screen">
bmk bsp_config</pre>

<p>The compiler is searched in the /opt folder. If it is found a link is created. Select the compiler, which you have just built. </p>
<pre class="screen">
bmk bsp_compiler</pre>

<p>Check PTXCONF_SETUP_SRCDIR in ptxdistrc for bsp</p>
<pre class="screen">
bmk bsp_check_srcdir</pre>
</div>
<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="idm140495282296832"></a>9.1.5. Barebox environment for tftpboot folder</h4></div></div></div>


<p>Download bundle of tftpboot_local</p>
<pre class="screen">
bmk download_bundle_git_tftpboot_local</pre>

<p>Create repository of local repository of tftpboot</p>
<pre class="screen">
bmk create_git_tftpboot_local</pre>

<p>Create new git work repository of current tftpboot and checkout files in new source folder for existing local repositories </p>
<pre class="screen">
bmk create_co_git_tftpboot_work</pre>

<p>cp env into images. Copy the prepared tftpboot files into the images folder</p>
<pre class="screen">
bmk archive_barebox_env</pre>
</div>
<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="idm140495282296672"></a>9.1.6. Summary</h4></div></div></div>


<p>Install Tools and BSP</p>
<pre class="screen">
bmk  \
	doc_download \
	ptxdist_download \
	ptxdist_extract \
	create_new_git_ptxdist_local \
	create_new_git_ptxdist_work \
	ptxdist_install \
	ptxdist_setup_srcdir \
	toolchain_download \
	toolchain_extract \
	create_new_git_toolchain_local \
	create_new_git_toolchain_work \
	toolchain_ptxdist \
	toolchain_prefix \
	toolchain_select \
	toolchain_migrate \
	toolchain_check_srcdir \
	toolchain_build \
	toolchain_clean_build \
	bsp_download \
	bsp_prepare \
	bsp_extract \
	create_new_git_bsp_local \
	create_new_git_bsp_work \
	bsp_config \
	bsp_compiler \
	bsp_check_srcdir \
	download_bundle_git_tftpboot_local \
	create_git_tftpboot_local \
	create_co_git_tftpboot_work \
	archive_barebox_env</pre>

<p>Push changes in work folder to local repository</p>
<pre class="screen">
bmk  \
	push_git_ptxdist_work \
	push_git_toolchain_work \
	push_git_bsp_work</pre>
</div>
</div>
<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="idm140495282266064"></a>9.2. Install Tools and BSP for Phytec Linux - Again</h3></div></div></div>


<p>When you want to install the tools and the bsp on the host again, you have to remove the make states before you can use the make targets. The additional commands are shown. </p>
<p>You have to understand what the commands are doing. Perhaps you have do remove some files or folders before you can use the make targets. </p>
<p>This chapter shows how to install the tool ptxdist, the toolchain and the BSP on the host.</p>
<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="idm140495282263184"></a>9.2.1. Download Docs</h4></div></div></div>


<p>download docs for bsp</p>
<pre class="screen">
bmk rm_doc_download
bmk doc_download</pre>
</div>
<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="idm140495282261296"></a>9.2.2. Ptxdist</h4></div></div></div>


<p>download files for ptxdist</p>
<pre class="screen">
bmk rm_ptxdist_download
bmk ptxdist_download</pre>

<p>Extract ptxdist</p>
<pre class="screen">
bmk rm_ptxdist_extract
bmk ptxdist_extract</pre>

<p>This creates a new and empty local repository for ptxdist, if it doesn't exist already. </p>
<pre class="screen">
bmk rm_create_new_git_ptxdist_local
bmk create_new_git_ptxdist_local</pre>

<p>Create new repository of current ptxdist and add source code to it. This creates a new work repository, adds the current source code to it and pushes it to the local repository. </p>
<pre class="screen">
bmk rm_create_new_git_ptxdist_work
bmk create_new_git_ptxdist_work</pre>

<p>Push changes in  ptxdist_work to local repository. If you have changed the work repository, push changes to the local repository. When you have just extracted the archive i.e. you have not done any changes, you can skip this command.</p>
<pre class="screen">
bmk rm_push_git_ptxdist_work
bmk push_git_ptxdist_work</pre>

<p>Install ptxdist</p>
<pre class="screen">
bmk rm_ptxdist_install
bmk ptxdist_install</pre>

<p>Select <code class="code">${MY_DOWNLOAD_SRC}</code> as common source directory, where all the archives are downloaded, only missing archives are downloaded. All archives which will be downloaded when building the toolchain or the bsp are downloaded in this folder. </p>
<pre class="screen">
bmk rm_ptxdist_setup_srcdir
bmk ptxdist_setup_srcdir</pre>
</div>
<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="idm140495282260976"></a>9.2.3. Toolchain</h4></div></div></div>


<p>download files for toolchain</p>
<pre class="screen">
bmk rm_toolchain_download
bmk toolchain_download</pre>

<p>Extract Toolchain</p>
<pre class="screen">
bmk rm_toolchain_extract
bmk toolchain_extract</pre>

<p>This creates a new and empty local repository for toolchain, if it doesn't exist already. </p>
<pre class="screen">
bmk rm_create_new_git_toolchain_local
bmk create_new_git_toolchain_local</pre>

<p>Create new repository of current toolchain and add source code to it. This creates a new work repository, adds the current source code to it and pushes it to the local repository. </p>
<pre class="screen">
bmk rm_create_new_git_toolchain_work
bmk create_new_git_toolchain_work</pre>

<p>Push changes in  toolchain_work to local repository. If you have changed the work repository, push changes to the local repository. When you have just extracted the archive i.e. you have not done any changes, you can skip this command.</p>
<pre class="screen">
bmk rm_push_git_toolchain_work
bmk push_git_toolchain_work</pre>

<p>This describes the usage of <code class="code">ptxdist</code> for building the toolchain. You don't need to call any of the commands, which are shown in the output, to install the toolchain right now. If you run into problems building the toolchain, you will need to call ptxdist directly. At the moment the output is only for your info: </p>
<pre class="screen">
bmk toolchain_ptxdist</pre>

<p>Set prefix for toolchain folder. The default is /opt. Here a local folder is selected in order not to interfere with other toolchains. </p>
<pre class="screen">
bmk rm_toolchain_prefix
bmk toolchain_prefix</pre>

<p>select the toolchain</p>
<pre class="screen">
bmk rm_toolchain_select
bmk toolchain_select</pre>

<p>migrate the config file to a new ptxdist version</p>
<pre class="screen">
bmk rm_toolchain_migrate
bmk toolchain_migrate</pre>

<p>check PTXCONF_SETUP_SRCDIR in ptxdistrc for toolchain</p>
<pre class="screen">
bmk rm_toolchain_check_srcdir
bmk toolchain_check_srcdir</pre>

<p>build the toolchain from scratch</p>
<pre class="screen">
bmk rm_toolchain_build
bmk toolchain_build</pre>

<p>remove temporary files of toolchain in order to save disk space</p>
<pre class="screen">
bmk rm_toolchain_clean_build
bmk toolchain_clean_build</pre>
</div>
<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="idm140495282252640"></a>9.2.4. BSP</h4></div></div></div>


<p>download files for bsp</p>
<pre class="screen">
bmk rm_bsp_download
bmk bsp_download</pre>

<p>Preparations for installing the BSP</p>
<pre class="screen">
bmk bsp_prepare</pre>

<p>Extract BSP</p>
<pre class="screen">
bmk rm_bsp_extract
bmk bsp_extract</pre>

<p>This creates a new and empty local repository for bsp, if it doesn't exist already. </p>
<pre class="screen">
bmk rm_create_new_git_bsp_local
bmk create_new_git_bsp_local</pre>

<p>Create new repository of current bsp and add source code to it.This creates a new work repository, adds the current source code to it and pushes it to the local repository. </p>
<pre class="screen">
bmk rm_create_new_git_bsp_work
bmk create_new_git_bsp_work</pre>

<p>Push changes in bsp_work to local repository. If you have changed the work repository, push changes to the local repository. When you have just extracted the archive i.e. you have not done any changes, you can skip this command.</p>
<pre class="screen">
bmk rm_push_git_bsp_work
bmk push_git_bsp_work</pre>

<p>Select the configuration files</p>
<pre class="screen">
bmk rm_bsp_config
bmk bsp_config</pre>

<p>The compiler is searched in the /opt folder. If it is found a link is created. Select the compiler, which you have just built. </p>
<pre class="screen">
bmk rm_bsp_compiler
bmk bsp_compiler</pre>

<p>Check PTXCONF_SETUP_SRCDIR in ptxdistrc for bsp</p>
<pre class="screen">
bmk rm_bsp_check_srcdir
bmk bsp_check_srcdir</pre>
</div>
<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="idm140495282252480"></a>9.2.5. Barebox environment for tftpboot folder</h4></div></div></div>


<p>Download bundle of tftpboot_local</p>
<pre class="screen">
bmk rm_download_bundle_git_tftpboot_local
bmk download_bundle_git_tftpboot_local</pre>

<p>Create repository of local repository of tftpboot</p>
<pre class="screen">
bmk rm_create_git_tftpboot_local
bmk create_git_tftpboot_local</pre>

<p>Create new git work repository of current tftpboot and checkout files in new source folder for existing local repositories </p>
<pre class="screen">
bmk rm_create_co_git_tftpboot_work
bmk create_co_git_tftpboot_work</pre>

<p>cp env into images. Copy the prepared tftpboot files into the images folder</p>
<pre class="screen">
bmk rm_archive_barebox_env
bmk archive_barebox_env</pre>
</div>
<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="idm140495282224576"></a>9.2.6. Summary</h4></div></div></div>


<p>Install Tools and BSP</p>
<pre class="screen">
bmk  \
	rm_doc_download \
	rm_ptxdist_download \
	rm_ptxdist_extract \
	rm_create_new_git_ptxdist_local \
	rm_create_new_git_ptxdist_work \
	rm_ptxdist_install \
	rm_ptxdist_setup_srcdir \
	rm_toolchain_download \
	rm_toolchain_extract \
	rm_create_new_git_toolchain_local \
	rm_create_new_git_toolchain_work \
	rm_toolchain_prefix \
	rm_toolchain_select \
	rm_toolchain_migrate \
	rm_toolchain_check_srcdir \
	rm_toolchain_build \
	rm_toolchain_clean_build \
	rm_bsp_download \
	rm_bsp_extract \
	rm_create_new_git_bsp_local \
	rm_create_new_git_bsp_work \
	rm_bsp_config \
	rm_bsp_compiler \
	rm_bsp_check_srcdir \
	rm_download_bundle_git_tftpboot_local \
	rm_create_git_tftpboot_local \
	rm_create_co_git_tftpboot_work \
	rm_archive_barebox_env
bmk  \
	doc_download \
	ptxdist_download \
	ptxdist_extract \
	create_new_git_ptxdist_local \
	create_new_git_ptxdist_work \
	ptxdist_install \
	ptxdist_setup_srcdir \
	toolchain_download \
	toolchain_extract \
	create_new_git_toolchain_local \
	create_new_git_toolchain_work \
	toolchain_ptxdist \
	toolchain_prefix \
	toolchain_select \
	toolchain_migrate \
	toolchain_check_srcdir \
	toolchain_build \
	toolchain_clean_build \
	bsp_download \
	bsp_prepare \
	bsp_extract \
	create_new_git_bsp_local \
	create_new_git_bsp_work \
	bsp_config \
	bsp_compiler \
	bsp_check_srcdir \
	download_bundle_git_tftpboot_local \
	create_git_tftpboot_local \
	create_co_git_tftpboot_work \
	archive_barebox_env</pre>

<p>Push changes in work folder to local repository</p>
<pre class="screen">
bmk  \
	rm_push_git_ptxdist_work \
	rm_push_git_toolchain_work \
	rm_push_git_bsp_work
bmk  \
	push_git_ptxdist_work \
	push_git_toolchain_work \
	push_git_bsp_work</pre>
</div>
</div>
<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="idm140495282265808"></a>9.3. Build BSP for Phytec Linux - First Time</h3></div></div></div>


<p>This chapter shows how to build the BSP on the host.</p>
<p>Build BSP with ptxdist </p>
<pre class="screen">
bmk bsp_go</pre>

<p>At the end you get the message: </p>

<p>Output:</p>
<pre class="screen">
-------------------------------------------------------------------
For a proper NFS-root environment, some device nodes are essential.
In order to create them root privileges are required.
-------------------------------------------------------------------

(Please press enter to start 'sudo' to gain root privileges.)


WARNING: NFS-root might not be working correctly!</pre>

<p>If you missed it you can build the bsp again with:</p>
<pre class="screen">
bmk rm_bsp_go
bmk bsp_go</pre>

<p>Output:</p>
<pre class="screen">
-------------------------------------------------------------------
For a proper NFS-root environment, some device nodes are essential.
In order to create them root privileges are required.
-------------------------------------------------------------------

(Please press enter to start 'sudo' to gain root privileges.)</pre>

<p>Press enter.</p>
<p>Output:</p>
<pre class="screen">
Password: </pre>

<p>Enter the root password. Output:</p>
<pre class="screen">
creating device node: platform-phyBOARD-WEGA-AM335x/root/dev/null
creating device node: platform-phyBOARD-WEGA-AM335x/root/dev/zero
creating device node: platform-phyBOARD-WEGA-AM335x/root/dev/console
creating device node: platform-phyBOARD-WEGA-AM335x/root-debug/dev/null
creating device node: platform-phyBOARD-WEGA-AM335x/root-debug/dev/zero
creating device node: platform-phyBOARD-WEGA-AM335x/root-debug/dev/console</pre>

<p>Create images for BSP with ptxdist </p>
<pre class="screen">
bmk bsp_images</pre>

<p>All binaries for the target have been created now. </p>
</div>
<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="idm140495282220224"></a>9.4. Develop BSP Phytec Linux - First Time</h3></div></div></div>


<p>This chapter shows how to change the source code for some packages.</p>
<p></p>
<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="idm140495282208688"></a>9.4.1. Call the ptxdist command directly</h4></div></div></div>


<p>This describes the usage of <code class="code">ptxdist</code> for developing and building the BSP:</p>
<pre class="screen">
bmk bsp_ptxdist</pre>

<p>You can create an environment setup file for using ptxdist and git on the commandline. </p>
<pre class="screen">
bmk setup_env_git_bsp_work</pre>

<p>The output of this make command describes the usage of the setup-env file. Follow the instructions.</p>
<p>Show examples for applying patches to bsp_work. </p>
<pre class="screen">
bmk apply_patches_git_bsp_work</pre>

<p>The output of this make command describes the usage of git to apply patches to the BSP. Follow the instructions.</p>
</div>
<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="idm140495282203312"></a>9.4.2. Development of the Kernel</h4></div></div></div>

<div class="sect4"><div class="titlepage"><div><div><h5 class="title"><a name="idm140495282202480"></a>9.4.2.1. Kernel config</h5></div></div></div>


<p>Call menuconfig for kernel</p>
<pre class="screen">
bmk bsp_kernelconfig</pre>

<p>The kernel config file is saved in the BSP. Check the changed kernel config file into the repository bsp_work. </p>
<pre class="screen">
bmk gui_git_bsp_work</pre>
</div>
<div class="sect4"><div class="titlepage"><div><div><h5 class="title"><a name="idm140495282199664"></a>9.4.2.2. Kernel source</h5></div></div></div>


<p>Create new repository of local repository of linux</p>
<pre class="screen">
bmk create_new_git_linux_local</pre>

<p>Create new repository of current linux with <code class="code">ptxdist --git extract kernel</code>. </p>
<p><span class="strong"><strong>Note: </strong></span>ptxdist clean kernel will be called. The source code folder will be deleted!</p>

<pre class="screen">
bmk create_new_git_ptxdist_linux_work</pre>

<p>Now you have a repository of the current linux which contains all the patches which have been shipped with the BSP. </p>
<p>You can create an environment setup file when you want to enter some git commands on the commandline.</p>
<pre class="screen">
bmk setup_env_git_linux_work</pre>

<p>The output of this make command describes the usage of the setup-env file. Follow the instructions.</p>
<p>Show examples for applying patches to linux_work. </p>
<pre class="screen">
bmk apply_patches_git_linux_work</pre>

<p>The output of this make command describes the usage of git to apply patches to the linux source. </p>
<p>After changing the source code of the kernel, you can compile it again. The kernel is built only with one make thread. If there is an error in the source code, it is easier to find. </p>
<pre class="screen">
bmk kernel-compile</pre>

<p>Check the changes of the source code into the repository linux_work. You can do it with the help of a GUI. </p>
<pre class="screen">
bmk gui_git_linux_work</pre>

<p>Create new patches for the BSP patches folder for Linux. </p>
<pre class="screen">
bmk create_ptx_patches_git_linux_work</pre>

<p>Now the patches for the Linux kernel have been saved in the BSP and you may remove the kernel source. </p>
<p>Clean kernel: you can remove all software parts of the kernel and force a complete rebuilt. If you have changed the source code of the kernel, you have to create the patches for it before you clean the kernel software. Otherwise all your changes are lost. </p>
<pre class="screen">
bmk kernel-clean</pre>
</div>
</div>
<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="idm140495282198864"></a>9.4.3. Development of barebox</h4></div></div></div>

<div class="sect4"><div class="titlepage"><div><div><h5 class="title"><a name="idm140495282186176"></a>9.4.3.1. Barebox source</h5></div></div></div>


<p>Create new repository of local repository of barebox</p>
<pre class="screen">
bmk create_new_git_barebox_local</pre>

<p>Create new repository of current barebox with <code class="code">ptxdist --git extract barebox</code>. </p>
<p><span class="strong"><strong>Note: </strong></span>ptxdist clean barebox will be called. The source code folder will be deleted!</p>

<pre class="screen">
bmk create_new_git_ptxdist_barebox_work</pre>

<p>Now you have a repository of the current barebox which contains all the patches which have been shipped with the BSP. </p>
<p>You can create an environment setup file when you want to enter some git commands on the commandline.</p>
<pre class="screen">
bmk setup_env_git_barebox_work</pre>

<p>The output of this make command describes the usage of the setup-env file. Follow the instructions.</p>
<p>Show examples for applying patches to barebox_work. </p>
<pre class="screen">
bmk apply_patches_git_barebox_work</pre>

<p>The output of this make command describes the usage of git to apply patches to the barebox source. </p>
<p>After changing the source code of barebox, you can compile it again. </p>
<pre class="screen">
bmk barebox-compile</pre>

<p>Check the changes of the source code into the repository barebox_work. You can do it with the help of a GUI. </p>
<pre class="screen">
bmk gui_git_barebox_work</pre>

<p>Create new patches for the BSP patches folder for Barebox. </p>
<pre class="screen">
bmk create_ptx_patches_git_barebox_work</pre>

<p>Now the patches for barebox have been saved in the BSP and you may remove barebox source. </p>
<p>Clean barebox: you can remove all software parts of barebox and force a complete rebuilt. If you have changed the source code of barebox, you have to create the patches for it before you clean barebox software. Otherwise all your changes are lost. </p>
<pre class="screen">
bmk barebox-clean</pre>
</div>
<div class="sect4"><div class="titlepage"><div><div><h5 class="title"><a name="idm140495282185760"></a>9.4.3.2. After changes in tftpboot environment</h5></div></div></div>


<p>Compare new env in folder tftpboot with current env</p>
<pre class="screen">
bmk compare_barebox_env</pre>

<p>cp env into images. Copy the prepared tftpboot files into the images folder</p>
<pre class="screen">
bmk archive_barebox_env</pre>

<p>Copy barebox config files into tftp folder. Now the files are copied into the real folder tftpboot, which is used by the tftp server. </p>
<pre class="screen">
bmk cp_barebox_config</pre>
</div>
</div>
</div>
<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="idm140495282169776"></a>9.5. Develop BSP for Phytec Linux - Again</h3></div></div></div>


<p>When you want to change the source code of some packages and build the BSP again, you have to remove the make states before you can use the make targets. The additional commands are shown. </p>
<p>This chapter shows how to change the source code for some packages.</p>
<p></p>
<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="idm140495282167472"></a>9.5.1. Call the ptxdist command directly</h4></div></div></div>


<p>This describes the usage of <code class="code">ptxdist</code> for developing and building the BSP:</p>
<pre class="screen">
bmk bsp_ptxdist</pre>

<p>You can create an environment setup file for using ptxdist and git on the commandline. </p>
<pre class="screen">
bmk rm_setup_env_git_bsp_work
bmk setup_env_git_bsp_work</pre>

<p>The output of this make command describes the usage of the setup-env file. Follow the instructions.</p>
<p>Show examples for applying patches to bsp_work. </p>
<pre class="screen">
bmk apply_patches_git_bsp_work</pre>

<p>The output of this make command describes the usage of git to apply patches to the BSP. Follow the instructions.</p>
</div>
<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="idm140495282162128"></a>9.5.2. Development of the Kernel</h4></div></div></div>

<div class="sect4"><div class="titlepage"><div><div><h5 class="title"><a name="idm140495282161424"></a>9.5.2.1. Kernel config</h5></div></div></div>


<p>Call menuconfig for kernel</p>
<pre class="screen">
bmk bsp_kernelconfig</pre>

<p>The kernel config file is saved in the BSP. Check the changed kernel config file into the repository bsp_work. </p>
<pre class="screen">
bmk gui_git_bsp_work</pre>
</div>
<div class="sect4"><div class="titlepage"><div><div><h5 class="title"><a name="idm140495282158464"></a>9.5.2.2. Kernel source</h5></div></div></div>


<p>Create new repository of local repository of linux</p>
<pre class="screen">
bmk rm_create_new_git_linux_local
bmk create_new_git_linux_local</pre>

<p>Create new repository of current linux with <code class="code">ptxdist --git extract kernel</code>. </p>
<p><span class="strong"><strong>Note: </strong></span>ptxdist clean kernel will be called. The source code folder will be deleted!</p>

<pre class="screen">
bmk rm_create_new_git_ptxdist_linux_work
bmk create_new_git_ptxdist_linux_work</pre>

<p>Now you have a repository of the current linux which contains all the patches which have been shipped with the BSP. </p>
<p>You can create an environment setup file when you want to enter some git commands on the commandline.</p>
<pre class="screen">
bmk rm_setup_env_git_linux_work
bmk setup_env_git_linux_work</pre>

<p>The output of this make command describes the usage of the setup-env file. Follow the instructions.</p>
<p>Show examples for applying patches to linux_work. </p>
<pre class="screen">
bmk apply_patches_git_linux_work</pre>

<p>The output of this make command describes the usage of git to apply patches to the linux source. </p>
<p>After changing the source code of the kernel, you can compile it again. The kernel is built only with one make thread. If there is an error in the source code, it is easier to find. </p>
<pre class="screen">
bmk rm_kernel-compile
bmk kernel-compile</pre>

<p>Check the changes of the source code into the repository linux_work. You can do it with the help of a GUI. </p>
<pre class="screen">
bmk gui_git_linux_work</pre>

<p>Create new patches for the BSP patches folder for Linux. </p>
<pre class="screen">
bmk rm_create_ptx_patches_git_linux_work
bmk create_ptx_patches_git_linux_work</pre>

<p>Now the patches for the Linux kernel have been saved in the BSP and you may remove the kernel source. </p>
<p>Clean kernel: you can remove all software parts of the kernel and force a complete rebuilt. If you have changed the source code of the kernel, you have to create the patches for it before you clean the kernel software. Otherwise all your changes are lost. </p>
<pre class="screen">
bmk rm_kernel-clean
bmk kernel-clean</pre>
</div>
</div>
<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="idm140495282158080"></a>9.5.3. Development of barebox</h4></div></div></div>

<div class="sect4"><div class="titlepage"><div><div><h5 class="title"><a name="idm140495282144768"></a>9.5.3.1. Barebox source</h5></div></div></div>


<p>Create new repository of local repository of barebox</p>
<pre class="screen">
bmk rm_create_new_git_barebox_local
bmk create_new_git_barebox_local</pre>

<p>Create new repository of current barebox with <code class="code">ptxdist --git extract barebox</code>. </p>
<p><span class="strong"><strong>Note: </strong></span>ptxdist clean barebox will be called. The source code folder will be deleted!</p>

<pre class="screen">
bmk rm_create_new_git_ptxdist_barebox_work
bmk create_new_git_ptxdist_barebox_work</pre>

<p>Now you have a repository of the current barebox which contains all the patches which have been shipped with the BSP. </p>
<p>You can create an environment setup file when you want to enter some git commands on the commandline.</p>
<pre class="screen">
bmk rm_setup_env_git_barebox_work
bmk setup_env_git_barebox_work</pre>

<p>The output of this make command describes the usage of the setup-env file. Follow the instructions.</p>
<p>Show examples for applying patches to barebox_work. </p>
<pre class="screen">
bmk apply_patches_git_barebox_work</pre>

<p>The output of this make command describes the usage of git to apply patches to the barebox source. </p>
<p>After changing the source code of barebox, you can compile it again. </p>
<pre class="screen">
bmk rm_barebox-compile
bmk barebox-compile</pre>

<p>Check the changes of the source code into the repository barebox_work. You can do it with the help of a GUI. </p>
<pre class="screen">
bmk gui_git_barebox_work</pre>

<p>Create new patches for the BSP patches folder for Barebox. </p>
<pre class="screen">
bmk rm_create_ptx_patches_git_barebox_work
bmk create_ptx_patches_git_barebox_work</pre>

<p>Now the patches for barebox have been saved in the BSP and you may remove barebox source. </p>
<p>Clean barebox: you can remove all software parts of barebox and force a complete rebuilt. If you have changed the source code of barebox, you have to create the patches for it before you clean barebox software. Otherwise all your changes are lost. </p>
<pre class="screen">
bmk rm_barebox-clean
bmk barebox-clean</pre>
</div>
<div class="sect4"><div class="titlepage"><div><div><h5 class="title"><a name="idm140495282144000"></a>9.5.3.2. After changes in tftpboot environment</h5></div></div></div>


<p>Compare new env in folder tftpboot with current env</p>
<pre class="screen">
bmk compare_barebox_env</pre>

<p>cp env into images. Copy the prepared tftpboot files into the images folder</p>
<pre class="screen">
bmk rm_archive_barebox_env
bmk archive_barebox_env</pre>

<p>Copy barebox config files into tftp folder. Now the files are copied into the real folder tftpboot, which is used by the tftp server. </p>
<pre class="screen">
bmk rm_cp_barebox_config
bmk cp_barebox_config</pre>
</div>
</div>
</div>
<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="idm140495282128128"></a>9.6. Build BSP for Phytec Linux - Again</h3></div></div></div>


<p>When you want to install the tools and the bsp on the host again, you have to remove the make states before you can use the make targets. The additional commands are shown. </p>
<p>You have to understand what the commands are doing. Perhaps you have do remove some files or folders before you can use the make targets. </p>
<p>This chapter shows how to build the BSP on the host.</p>
<p>Build BSP with ptxdist </p>
<pre class="screen">
bmk rm_bsp_go
bmk bsp_go</pre>

<p>Create images for BSP with ptxdist </p>
<pre class="screen">
bmk rm_bsp_images
bmk bsp_images</pre>

<p>All binaries for the target have been created now. </p>
</div>
<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="idm140495282123280"></a>9.7. Use Binary Versions of Phytec Linux - First Time</h3></div></div></div>


<p>This chapter shows how to download the binary images of the bootloader, Linux kernel and the root file system and boot the device in different ways. </p>
<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="idm140495282121632"></a>9.7.1. Create Archives of Filesystems and Install  Phytec Linux BSP on SD-Card for boot_mmc</h4></div></div></div>


<p>Save barebox image, kernel image and device tree in image folder. </p>
<pre class="screen">
bmk kernel_01</pre>

<p>overwrite image area on SD-card with zeros , format SD-card, create binary image</p>
<pre class="screen">
bmk  parted_sdcard_01 cp_archive_sdcard_01 cp_file_sdcard_01</pre>
</div>
<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="idm140495282118704"></a>9.7.2. Update Bootloader in NAND</h4></div></div></div>


<p>You can update the bootloader in NAND:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<p>by copying the images from SD-Card or </p></li><li class="listitem">
<p>by downloading the images from an TFTP server. </p></li></ul></div>
<div class="sect4"><div class="titlepage"><div><div><h5 class="title"><a name="idm140495282115296"></a>9.7.2.1. Use images from SD-Card</h5></div></div></div>


<p>You can copy the images from an SD-card :</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<p>after booting from the SD-Card or</p></li><li class="listitem">
<p>after mounting the SD-Card manually. </p></li></ul></div>
<div class="sect5"><div class="titlepage"><div><div><h6 class="title"><a name="idm140495282112016"></a>9.7.2.1.1. Boot from SD-Card</h6></div></div></div>


<p>When you boot from SD-card, the card is already mounted at /boot.</p>

<p>Check which devices are known</p>
<pre class="screen">
devinfo</pre>

<p>Check which images are on the SD-card</p>
<pre class="screen">
ls /boot</pre>

<p>Output:</p>
<pre class="screen">
MLO            barebox.bin    barebox.env    linuximage    </pre>

<p>Update x-loader MLO</p>
<pre class="screen">
erase /dev/nand0.xload.bb
cp /boot/MLO /dev/nand0.xload.bb</pre>

<p>Update barebox</p>
<pre class="screen">
erase /dev/nand0.barebox.bb
cp /boot/barebox.bin /dev/nand0.barebox.bb</pre>

<p>When the bootloader has changed significantly, it is also necessary to erase the barebox environment:</p>
<pre class="screen">
erase /dev/nand0.bareboxenv</pre>
</div>
<div class="sect5"><div class="titlepage"><div><div><h6 class="title"><a name="idm140495282111760"></a>9.7.2.1.2. Mount SD-Card</h6></div></div></div>


<p>Further information is available in L-775e_3.pdf on page 22. </p>

<p>Insert SD-Card and mount it. </p>

<p>Check which devices are known</p>
<pre class="screen">
devinfo</pre>

<p>Mount the SD-card, if it is not already mounted:</p>
<pre class="screen">
mci0.probe=1
ls /mnt
mkdir /mnt/disk
mount /dev/disk0.0 /mnt/disk</pre>

<p>Check which images are on the SD-card</p>
<pre class="screen">
ls /mnt/disk</pre>

<p>Output:</p>
<pre class="screen">
MLO            barebox.bin    linuximage    </pre>

<p>Update x-loader MLO</p>
<pre class="screen">
erase /dev/nand0.xload.bb
cp /mnt/disk/MLO /dev/nand0.xload.bb</pre>

<p>Update barebox</p>
<pre class="screen">
erase /dev/nand0.barebox.bb
cp /mnt/disk/barebox.bin /dev/nand0.barebox.bb</pre>

<p>When the bootloader has changed significantly, it is also necessary to erase the barebox environment:</p>
<pre class="screen">
erase /dev/nand0.bareboxenv</pre>
</div>
</div>
<div class="sect4"><div class="titlepage"><div><div><h5 class="title"><a name="idm140495282104624"></a>9.7.2.2. Download images from TFTP Server</h5></div></div></div>


<p>Copy barebox image of boot_nand into images folder</p>
<pre class="screen">
bmk cp_barebox_boot_nand</pre>

<p>Copy barebox from images folder into tftp folder</p>
<pre class="screen">
bmk tftpboot_barebox</pre>

<p>Update barebox via TFTP</p>
<pre class="screen">
bmk update_barebox</pre>
</div>
</div>
<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="idm140495282092896"></a>9.7.3. Boot via NAND</h4></div></div></div>


<p>copy kernel image for boot_tftp_nfs and boot_nand into images folder</p>
<pre class="screen">
bmk kernel_boot_tftp_nfs</pre>

<p>Copy kernel into tftp folder</p>
<pre class="screen">
bmk tftpboot_kernel</pre>

<p>Copy the ubi image of boot_nand</p>
<pre class="screen">
bmk cp_image_boot_nand</pre>

<p>Copy root.ubi into tftp folder</p>
<pre class="screen">
bmk tftpboot_root_ubi</pre>

<p>Update kernel and root on target for boot_nand</p>
<pre class="screen">
bmk update_target_boot_nand</pre>
</div>
<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="Boot_via_TFTP_and_NFS"></a>9.7.4. Boot via TFTP and NFS</h4></div></div></div>

<div class="sect4"><div class="titlepage"><div><div><h5 class="title"><a name="idm140495282086144"></a>9.7.4.1. Prepare tftp config</h5></div></div></div>


<p>cp env into images. Copy the prepared tftpboot files into the images folder</p>
<pre class="screen">
bmk archive_barebox_env</pre>

<p>Barebox config files are copied into the real folder tftpboot, which is used by the tftp server. Do it only once. Default settings are to boot from NAND. </p>
<pre class="screen">
bmk cp_barebox_config</pre>

<p>Because the config files contain dummy ip addresses, it is important to set the correct ip addresses.</p>
<pre class="screen">
bmk set_ip_barebox_config</pre>
</div>
<div class="sect4"><div class="titlepage"><div><div><h5 class="title"><a name="idm140495282082288"></a>9.7.4.2. Copy init files to the Target </h5></div></div></div>


<p>Copy <code class="code">env/boot/net-02</code> and some other files to the target.</p>
<pre class="screen">
bmk cp_init_board</pre>

<p>The output of this make command describes how to download files to the target. Follow the instructions.</p>
<p>When barebox is restarted, <code class="code">/env/network/eth0</code> is used to configure the Ethernet port. When you call </p>
<pre class="screen">
boot net-02</pre>

<p> you can boot the board via TFTP and NFS. The file <code class="code">/env/boot/net-02</code> is executed and loads the file <code class="code">/env/bin/net-03</code> from the TFTP server. This file is also executed. </p>
<p><span class="strong"><strong>Note: </strong></span>It is very important that you copy the init files to the target. Some commands in the makefile are changing the config file in the tftpboot folder on the host.</p>
</div>
<div class="sect4"><div class="titlepage"><div><div><h5 class="title"><a name="idm140495282075360"></a>9.7.4.3. Setup barebox config to boot via tftp and nfs </h5></div></div></div>


<p>Adjust boot.default in env/config to boot from TFTP and NFS</p>
<pre class="screen">
bmk tftpboot_config_loc_boot_tftp_nfs</pre>
</div>
<div class="sect4"><div class="titlepage"><div><div><h5 class="title"><a name="idm140495282073600"></a>9.7.4.4. Prepare kernel and rootfs for boot via TFTP and NFS </h5></div></div></div>


<p>Build BSP with ptxdist </p>
<pre class="screen">
bmk bsp_go</pre>

<p>Create images for BSP with ptxdist </p>
<pre class="screen">
bmk bsp_images</pre>

<p>copy kernel image for boot_tftp_nfs into images folder</p>
<pre class="screen">
bmk kernel_boot_tftp_nfs</pre>

<p>Copy kernel from images into tftp folder</p>
<pre class="screen">
bmk tftpboot_kernel</pre>

<p>Copy RootFS Archive of boot_tftp_nfs into images</p>
<pre class="screen">
bmk cp_image_boot_tftp_nfs</pre>

<p>Create root file system, which can be mounted via NFS. </p>
<pre class="screen">
bmk create_rootfs_boot_tftp_nfs</pre>

<p>Setup NFS, add rootfs to /etc/exports</p>
<pre class="screen">
bmk export_rootfs</pre>

<p>exportfs -r</p>
<pre class="screen">
bmk export_refresh</pre>

<p>remove fingerprint in .ssh/known_hosts</p>
<pre class="screen">
bmk ssh_fingerprint</pre>

<p>Adjust nfsroot in env/config</p>
<pre class="screen">
bmk tftpboot_config</pre>

<p>show command for netconsole</p>
<pre class="screen">
bmk netconsole</pre>
</div>
<div class="sect4"><div class="titlepage"><div><div><h5 class="title"><a name="idm140495282073472"></a>9.7.4.5. Switching between booting from NAND and via TFTP and NFS</h5></div></div></div>


<p>You have just configured the board to boot via TFTP and NFS. If you want to switch back to booting from NAND, you can use the following command. </p>
<p>Adjust boot.default in env/config to boot from NAND</p>
<pre class="screen">
bmk tftpboot_config_loc_boot_nand</pre>

<p>If you want to switch again to booting via TFTP and NFS, you can use again the following command. </p>
<p>Adjust boot.default in env/config to boot from TFTP and NFS</p>
<pre class="screen">
bmk rm_tftpboot_config_loc_boot_tftp_nfs
bmk tftpboot_config_loc_boot_tftp_nfs</pre>
</div>
</div>
<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="idm140495282058688"></a>9.7.5. Boot the board</h4></div></div></div>


<p>Check if you have the correct hardware versions:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<p>phyBOARD-WEGA-AM335x with carrier board 1405.0 or 1405.1</p></li><li class="listitem">
<p>HDMI Adapter PEB-AV-01 1406.0 or 1406.1</p></li><li class="listitem">
<p>Eval Module PEB-EVAL-01 1413.0 or 1413.1</p></li></ul></div>

<p>By default the board tries to boot from NAND at first. Without any valid bootloader in NAND, the board will try to boot from SD-card next.</p>
<p>You can force the board to try to boot from SD-card at first. This allows you to test the bootloader on the SD-card without changing anything in NAND.</p>
<p>If you have the carrier board 1405.0:</p>

<p>You can force the board to boot from SD-card by connecting X_LCD_D2 (pin 8 at X70) to a high-level (e.g. VCC3V3 &#8211; pin13 at X71) during the power-up sequence.</p>
<p>If you have the carrier board 1405.1: </p>

<p>Take off the expansion board PEB-AV-01 or PEB-AV-02. Move the DIP switch to ON, to force booting from SD-card. When you have moved the switch in direction of the SD-card slot, the switch is in position ON. </p>
<p>The description how to boot from SD-card can be found in L-792e_0.pdf on page 77 and in <a class="ulink" href="http://www.phytec.de/de/support/faq/faq-phyboard-wega.html" target="_top">http://www.phytec.de/de/support/faq/faq-phyboard-wega.html</a>. </p>
<p>Connect the board to the host, network and display: </p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<p>Connect a serial cable (one-to-one) to the DB9 connector on PEB-EVAL-01. Set the speed to 115200 8N1 in your terminal application on the host. </p></li><li class="listitem">
<p>Connect an ethernet cable to the port X16 on the carrier board. This is the ethernet port next to the USB port. </p></li><li class="listitem">
<p>If you want to work with an SD-card, insert the SD-card into carrier board. </p></li><li class="listitem">
<p>You can connect also a display to the HDMI port on PEB-AV-01. </p></li></ul></div>

<p>Boot the board again. </p>
</div>
<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="idm140495282058304"></a>9.7.6. Summary</h4></div></div></div>


<p>Create images for SD-card</p>
<pre class="screen">
bmk  \
	kernel_01 \
	parted_sdcard_01 \
	cp_archive_sdcard_01 \
	cp_file_sdcard_01</pre>

<p>update barebox, kernel and root file system in NAND</p>
<pre class="screen">
bmk  \
	cp_barebox_boot_nand \
	tftpboot_barebox \
	update_barebox \
	cp_image_boot_nand \
	tftpboot_root_ubi \
	kernel_boot_tftp_nfs \
	tftpboot_kernel \
	update_target_boot_nand</pre>

<p>update kernel and root file system in NAND</p>
<pre class="screen">
bmk  \
	cp_image_boot_nand \
	tftpboot_root_ubi \
	kernel_boot_tftp_nfs \
	tftpboot_kernel \
	update_target_boot_nand</pre>

<p>Prepare tftp config for boot via tftp and nfs</p>
<pre class="screen">
bmk  \
	archive_barebox_env \
	cp_barebox_config \
	set_ip_barebox_config \
	cp_init_board \
	tftpboot_config_loc_boot_tftp_nfs</pre>

<p>Prepare kernel and rootfs for boot via TFTP and NFS </p>
<pre class="screen">
bmk  \
	bsp_go \
	bsp_images \
	kernel_boot_tftp_nfs \
	cp_image_boot_tftp_nfs \
	tftpboot_kernel \
	create_rootfs_boot_tftp_nfs \
	export_rootfs \
	export_refresh \
	ssh_fingerprint \
	tftpboot_config \
	netconsole</pre>

<p>Switch back to boot from NAND. Adjust boot.default in env/config to boot from NAND</p>
<pre class="screen">
bmk  \
	tftpboot_config_loc_boot_nand</pre>

<p>Switch again to boot via TFTP and NFS. Adjust boot.default in env/config to boot from TFTP and NFS</p>
<pre class="screen">
bmk  \
	rm_tftpboot_config_loc_boot_tftp_nfs
bmk  \
	tftpboot_config_loc_boot_tftp_nfs</pre>
</div>
</div>
<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="idm140495282044736"></a>9.8. Use Binary Versions of Phytec Linux - Again</h3></div></div></div>


<p>When you want to install the binary images in the internal flash again, you have to remove the make states before you can use the make targets. The additional commands are shown. </p>
<p>This chapter shows how to download the binary images of the bootloader, Linux kernel and the root file system and boot the device in different ways. </p>
<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="idm140495282034976"></a>9.8.1. Create Archives of Filesystems and Install  Phytec Linux BSP on SD-Card for boot_mmc</h4></div></div></div>


<p>Build Phytec Linux BSP, if you have not already done it.Build BSP with ptxdist </p>
<pre class="screen">
bmk rm_bsp_go
bmk bsp_go</pre>

<p>Create images for BSP with ptxdist </p>
<pre class="screen">
bmk rm_bsp_images
bmk bsp_images</pre>

<p>Save barebox image, kernel image and device tree in image folder. </p>
<p><span class="strong"><strong>Note: </strong></span>You only have to do this again, when the image has been rebuilt. </p>

<pre class="screen">
bmk rm_kernel_01 rm_kernel_boot_tftp_nfs rm_cp_image_boot_tftp_nfs
bmk kernel_01</pre>

<p>overwrite image area on SD-card with zeros , format SD-card, create binary image</p>
<pre class="screen">
bmk  rm_parted_sdcard_01
bmk  parted_sdcard_01 cp_archive_sdcard_01 cp_file_sdcard_01</pre>
</div>
<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="idm140495282029136"></a>9.8.2. Update Bootloader in NAND</h4></div></div></div>


<p>You can update the bootloader in NAND:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<p>by copying the images from SD-Card or </p></li><li class="listitem">
<p>by downloading the images from an TFTP server. </p></li></ul></div>
<div class="sect4"><div class="titlepage"><div><div><h5 class="title"><a name="idm140495282025648"></a>9.8.2.1. Use images from SD-Card</h5></div></div></div>


<p>You can copy the images from an SD-card :</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<p>after booting from the SD-Card or</p></li><li class="listitem">
<p>after mounting the SD-Card manually. </p></li></ul></div>
<div class="sect5"><div class="titlepage"><div><div><h6 class="title"><a name="idm140495282022224"></a>9.8.2.1.1. Boot from SD-Card</h6></div></div></div>


<p>When you boot from SD-card, the card is already mounted at /boot.</p>

<p>Check which devices are known</p>
<pre class="screen">
devinfo</pre>

<p>Check which images are on the SD-card</p>
<pre class="screen">
ls /boot</pre>

<p>Output:</p>
<pre class="screen">
MLO            barebox.bin    barebox.env    linuximage    </pre>

<p>Update x-loader MLO</p>
<pre class="screen">
erase /dev/nand0.xload.bb
cp /boot/MLO /dev/nand0.xload.bb</pre>

<p>Update barebox</p>
<pre class="screen">
erase /dev/nand0.barebox.bb
cp /boot/barebox.bin /dev/nand0.barebox.bb</pre>

<p>When the bootloader has changed significantly, it is also necessary to erase the barebox environment:</p>
<pre class="screen">
erase /dev/nand0.bareboxenv</pre>
</div>
<div class="sect5"><div class="titlepage"><div><div><h6 class="title"><a name="idm140495282021968"></a>9.8.2.1.2. Mount SD-Card</h6></div></div></div>


<p>Further information is available in L-775e_3.pdf on page 22. </p>

<p>Insert SD-Card and mount it. </p>

<p>Check which devices are known</p>
<pre class="screen">
devinfo</pre>

<p>Mount the SD-card, if it is not already mounted:</p>
<pre class="screen">
mci0.probe=1
ls /mnt
mkdir /mnt/disk
mount /dev/disk0.0 /mnt/disk</pre>

<p>Check which images are on the SD-card</p>
<pre class="screen">
ls /mnt/disk</pre>

<p>Output:</p>
<pre class="screen">
MLO            barebox.bin    linuximage    </pre>

<p>Update x-loader MLO</p>
<pre class="screen">
erase /dev/nand0.xload.bb
cp /mnt/disk/MLO /dev/nand0.xload.bb</pre>

<p>Update barebox</p>
<pre class="screen">
erase /dev/nand0.barebox.bb
cp /mnt/disk/barebox.bin /dev/nand0.barebox.bb</pre>

<p>When the bootloader has changed significantly, it is also necessary to erase the barebox environment:</p>
<pre class="screen">
erase /dev/nand0.bareboxenv</pre>
</div>
</div>
<div class="sect4"><div class="titlepage"><div><div><h5 class="title"><a name="idm140495282014928"></a>9.8.2.2. Download images from TFTP Server</h5></div></div></div>


<p>Copy barebox image of boot_nand into images folder</p>
<pre class="screen">
bmk rm_cp_barebox_boot_nand
bmk cp_barebox_boot_nand</pre>

<p>Copy barebox from images folder into tftp folder</p>
<pre class="screen">
bmk rm_tftpboot_barebox
bmk tftpboot_barebox</pre>

<p>Update barebox via TFTP</p>
<pre class="screen">
bmk rm_update_barebox
bmk update_barebox</pre>
</div>
</div>
<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="idm140495282002928"></a>9.8.3. Boot via NAND</h4></div></div></div>


<p>copy kernel image for boot_tftp_nfs and boot_nand into images folder</p>
<pre class="screen">
bmk rm_kernel_boot_tftp_nfs
bmk kernel_boot_tftp_nfs</pre>

<p>Copy kernel into tftp folder</p>
<pre class="screen">
bmk rm_tftpboot_kernel
bmk tftpboot_kernel</pre>

<p>Copy the ubi image of boot_nand</p>
<pre class="screen">
bmk rm_cp_image_boot_nand
bmk cp_image_boot_nand</pre>

<p>Copy root.ubi into tftp folder</p>
<pre class="screen">
bmk rm_tftpboot_root_ubi
bmk tftpboot_root_ubi</pre>

<p>Update kernel and root on target for boot_nand</p>
<pre class="screen">
bmk update_target_boot_nand</pre>
</div>
<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="idm140495282002640"></a>9.8.4. Boot via TFTP and NFS</h4></div></div></div>

<div class="sect4"><div class="titlepage"><div><div><h5 class="title"><a name="idm140495281996352"></a>9.8.4.1. Copy init files to the Target </h5></div></div></div>


<p>Copy <code class="code">env/boot/net-02</code> and some other files to the target.</p>
<pre class="screen">
bmk rm_cp_init_board
bmk cp_init_board</pre>

<p>The output of this make command describes how to download files to the target. Follow the instructions.</p>
<p>When barebox is restarted, <code class="code">/env/network/eth0</code> is used to configure the Ethernet port. When you call </p>
<pre class="screen">
boot net-02</pre>

<p> you can boot the board via TFTP and NFS. The file <code class="code">/env/boot/net-02</code> is executed and loads the file <code class="code">/env/bin/net-03</code> from the TFTP server. This file is also executed. </p>
<p><span class="strong"><strong>Note: </strong></span>It is very important that you copy the init files to the target. Some commands in the makefile are changing the config file in the tftpboot folder on the host.</p>
</div>
<div class="sect4"><div class="titlepage"><div><div><h5 class="title"><a name="idm140495281989504"></a>9.8.4.2. Setup barebox config to boot via tftp and nfs </h5></div></div></div>


<p>Adjust boot.default in env/config to boot from TFTP and NFS</p>
<pre class="screen">
bmk rm_tftpboot_config_loc_boot_tftp_nfs
bmk tftpboot_config_loc_boot_tftp_nfs</pre>
</div>
<div class="sect4"><div class="titlepage"><div><div><h5 class="title"><a name="idm140495281987648"></a>9.8.4.3. Prepare kernel and rootfs for boot via TFTP and NFS </h5></div></div></div>


<p>Build BSP with ptxdist </p>
<pre class="screen">
bmk rm_bsp_go
bmk bsp_go</pre>

<p>Create images for BSP with ptxdist </p>
<pre class="screen">
bmk rm_bsp_images
bmk bsp_images</pre>

<p>copy kernel image for boot_tftp_nfs into images folder</p>
<pre class="screen">
bmk rm_kernel_boot_tftp_nfs
bmk kernel_boot_tftp_nfs</pre>

<p>Copy kernel from images into tftp folder</p>
<pre class="screen">
bmk rm_tftpboot_kernel
bmk tftpboot_kernel</pre>

<p>Copy RootFS Archive of boot_tftp_nfs into images</p>
<pre class="screen">
bmk rm_cp_image_boot_tftp_nfs
bmk cp_image_boot_tftp_nfs</pre>

<p>Remove root file system, which can be mounted via NFS. </p>
<pre class="screen">
bmk rm_remove_rootfs_boot_tftp_nfs
bmk remove_rootfs_boot_tftp_nfs -n
bmk remove_rootfs_boot_tftp_nfs</pre>

<p>Create root file system, which can be mounted via NFS. </p>
<pre class="screen">
bmk rm_create_rootfs_boot_tftp_nfs
bmk create_rootfs_boot_tftp_nfs</pre>

<p>exportfs -r</p>
<pre class="screen">
bmk export_refresh</pre>

<p>remove fingerprint in .ssh/known_hosts</p>
<pre class="screen">
bmk rm_ssh_fingerprint
bmk ssh_fingerprint</pre>

<p>show command for netconsole</p>
<pre class="screen">
bmk rm_netconsole
bmk netconsole</pre>
</div>
<div class="sect4"><div class="titlepage"><div><div><h5 class="title"><a name="idm140495281987520"></a>9.8.4.4. Switching between booting from NAND and via TFTP and NFS</h5></div></div></div>


<p>You have just configured the board to boot via TFTP and NFS. If you want to switch back to booting from NAND, you can use the following command. </p>
<p>Adjust boot.default in env/config to boot from NAND</p>
<pre class="screen">
bmk rm_tftpboot_config_loc_boot_nand
bmk tftpboot_config_loc_boot_nand</pre>

<p>If you want to switch again to booting via TFTP and NFS, you can use again the following command. </p>
<p>Adjust boot.default in env/config to boot from TFTP and NFS</p>
<pre class="screen">
bmk rm_tftpboot_config_loc_boot_tftp_nfs
bmk tftpboot_config_loc_boot_tftp_nfs</pre>
</div>
</div>
<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="idm140495281973248"></a>9.8.5. Boot the board</h4></div></div></div>


<p>Check if you have the correct hardware versions:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<p>phyBOARD-WEGA-AM335x with carrier board 1405.0 or 1405.1</p></li><li class="listitem">
<p>HDMI Adapter PEB-AV-01 1406.0 or 1406.1</p></li><li class="listitem">
<p>Eval Module PEB-EVAL-01 1413.0 or 1413.1</p></li></ul></div>

<p>By default the board tries to boot from NAND at first. Without any valid bootloader in NAND, the board will try to boot from SD-card next.</p>
<p>You can force the board to try to boot from SD-card at first. This allows you to test the bootloader on the SD-card without changing anything in NAND.</p>
<p>If you have the carrier board 1405.0:</p>

<p>You can force the board to boot from SD-card by connecting X_LCD_D2 (pin 8 at X70) to a high-level (e.g. VCC3V3 &#8211; pin13 at X71) during the power-up sequence.</p>
<p>If you have the carrier board 1405.1: </p>

<p>Take off the expansion board PEB-AV-01 or PEB-AV-02. Move the DIP switch to ON, to force booting from SD-card. When you have moved the switch in direction of the SD-card slot, the switch is in position ON. </p>
<p>The description how to boot from SD-card can be found in L-792e_0.pdf on page 77 and in <a class="ulink" href="http://www.phytec.de/de/support/faq/faq-phyboard-wega.html" target="_top">http://www.phytec.de/de/support/faq/faq-phyboard-wega.html</a>. </p>
<p>Connect the board to the host, network and display: </p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<p>Connect a serial cable (one-to-one) to the DB9 connector on PEB-EVAL-01. Set the speed to 115200 8N1 in your terminal application on the host. </p></li><li class="listitem">
<p>Connect an ethernet cable to the port X16 on the carrier board. This is the ethernet port next to the USB port. </p></li><li class="listitem">
<p>If you want to work with an SD-card, insert the SD-card into carrier board. </p></li><li class="listitem">
<p>You can connect also a display to the HDMI port on PEB-AV-01. </p></li></ul></div>

<p>Boot the board again. </p>
</div>
<div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a name="idm140495281972992"></a>9.8.6. Summary</h4></div></div></div>


<p>Create images for SD-card</p>
<pre class="screen">
bmk  \
	rm_bsp_go \
	rm_bsp_images \
	rm_kernel_01 \
	rm_kernel_boot_tftp_nfs \
	rm_cp_image_boot_tftp_nfs
bmk  \
	bsp_go \
	bsp_images \
	kernel_01</pre>

<pre class="screen">
bmk  \
	rm_parted_sdcard_01
bmk  \
	parted_sdcard_01 \
	cp_archive_sdcard_01 \
	cp_file_sdcard_01</pre>

<p>update barebox, kernel and root file system in NAND</p>
<pre class="screen">
bmk  \
	rm_cp_barebox_boot_nand \
	rm_tftpboot_barebox \
	rm_update_barebox \
	rm_cp_image_boot_nand \
	rm_tftpboot_root_ubi \
	rm_kernel_boot_tftp_nfs \
	rm_tftpboot_kernel
bmk  \
	cp_barebox_boot_nand \
	tftpboot_barebox \
	update_barebox \
	cp_image_boot_nand \
	tftpboot_root_ubi \
	kernel_boot_tftp_nfs \
	tftpboot_kernel \
	update_target_boot_nand</pre>

<p>update kernel and root file system in NAND</p>
<pre class="screen">
bmk  \
	rm_cp_image_boot_nand \
	rm_tftpboot_root_ubi \
	rm_kernel_boot_tftp_nfs \
	rm_tftpboot_kernel
bmk  \
	cp_image_boot_nand \
	tftpboot_root_ubi \
	kernel_boot_tftp_nfs \
	tftpboot_kernel \
	update_target_boot_nand</pre>

<p>Prepare tftp config for boot via tftp and nfs</p>
<pre class="screen">
bmk  \
	rm_set_ip_barebox_config \
	rm_cp_init_board \
	rm_tftpboot_config_loc_boot_tftp_nfs
bmk  \
	set_ip_barebox_config \
	cp_init_board \
	tftpboot_config_loc_boot_tftp_nfs</pre>

<p>Prepare kernel and rootfs for boot via TFTP and NFS </p>
<pre class="screen">
bmk  \
	rm_bsp_go \
	rm_bsp_images \
	rm_kernel_boot_tftp_nfs \
	rm_cp_image_boot_tftp_nfs \
	rm_tftpboot_kernel \
	rm_remove_rootfs_boot_tftp_nfs \
	rm_create_rootfs_boot_tftp_nfs \
	rm_ssh_fingerprint
bmk  \
	bsp_go \
	bsp_images \
	kernel_boot_tftp_nfs \
	cp_image_boot_tftp_nfs \
	tftpboot_kernel \
	remove_rootfs_boot_tftp_nfs \
	create_rootfs_boot_tftp_nfs \
	export_refresh \
	ssh_fingerprint \
	netconsole</pre>

<p>Switch back to boot from NAND. Adjust boot.default in env/config to boot from NAND</p>
<pre class="screen">
bmk  \
	rm_tftpboot_config_loc_boot_nand
bmk  \
	tftpboot_config_loc_boot_nand</pre>

<p>Switch again to boot via TFTP and NFS. Adjust boot.default in env/config to boot from TFTP and NFS</p>
<pre class="screen">
bmk  \
	rm_tftpboot_config_loc_boot_tftp_nfs
bmk  \
	tftpboot_config_loc_boot_tftp_nfs</pre>

<p>This is usually used only once, but may be reused: Copy barebox config files into tftp folder and adjust all the settings to boot via TFTP and NFS.</p>
<pre class="screen">
bmk  \
	rm_cp_barebox_config \
	rm_set_ip_barebox_config \
	rm_tftpboot_config \
	rm_tftpboot_config_loc_boot_tftp_nfs
bmk  \
	cp_barebox_config \
	set_ip_barebox_config \
	tftpboot_config \
	tftpboot_config_loc_boot_tftp_nfs</pre>

<p>This is usually used only once, but may be reused: Adjust nfsroot in env/config</p>
<pre class="screen">
bmk  \
	rm_tftpboot_config
bmk  \
	tftpboot_config</pre>

<p>This is usually used only once, but may be reused: Setup NFS, add rootfs to /etc/exports</p>
<pre class="screen">
bmk  \
	rm_export_rootfs
bmk  \
	export_rootfs</pre>
</div>
</div>
</div>
<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm140495282309888"></a>10. Test or Debug</h2></div></div></div>


<p>Remove fingerprint in .ssh/known_hosts</p>
<pre class="screen">
bmk rm_ssh_fingerprint
bmk ssh_fingerprint</pre>

<p>show command for netconsole</p>
<pre class="screen">
bmk netconsole</pre>

<p>dmesg over ssh</p>
<pre class="screen">
bmk ssh_dmesg</pre>
</div>
<div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idm140495281944144"></a>11. Version Control with Git</h2></div></div></div>


<p>Create and manage git repositories for the source code of the BSP and its software packages. </p>
<p>If you want to learn more about git, there is a book on git : <a class="ulink" href="http://www.git-scm.com/book" target="_top">Pro Git</a></p>
<p>There are many more make targets in the makefile <code class="code">${DISTRIB_IN}/install/scripts/pd_src_git.mk</code> which have not been described so far. You can list most of the make targets with the following command:</p>
<pre class="screen">
bmk | grep git</pre>

<p>You can look at the contents of the file <code class="code">${DISTRIB_IN}/install/scripts/pd_src_git.mk</code></p>
<pre class="screen">
more ${DISTRIB_IN}/install/scripts/pd_src_git.mk</pre>

<p>In this tutorial and the accompanying makefile some specific names are used for the repositories:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<p>A repository is called <span class="emphasis"><em>work</em></span>, when it is used to checkout and edit the current version of the source code. </p></li><li class="listitem">
<p>A repository is called <span class="emphasis"><em>local</em></span>, when it is used to save the current state of the source code on your computer. You push your changes from the <span class="emphasis"><em>work</em></span> repository to the <span class="emphasis"><em>local</em></span> repository, to save it there. This is a bare repository. </p></li><li class="listitem">
<p>A <span class="emphasis"><em>remote</em></span> repository is used to create or update the <span class="emphasis"><em>local</em></span> repository. Usually you don't have write access to the <span class="emphasis"><em>remote</em></span> repository. </p></li></ul></div>

<p>In the following chapters some useful commands are shown.</p>
<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="idm140495281931168"></a>11.1. Create environment setup files</h3></div></div></div>


<p>For the work with repositories of some source code folders you need to define an environment.</p>
<p>Create environment setup file for barebox_work</p>
<pre class="screen">
bmk rm_setup_env_git_barebox_work
bmk setup_env_git_barebox_work</pre>

<p>The output of this make command describes the usage of the setup-env file. Follow the instructions.</p>
<p>Create environment setup file for linux_work</p>
<pre class="screen">
bmk rm_setup_env_git_linux_work
bmk setup_env_git_linux_work</pre>

<p>The output of this make command describes the usage of the setup-env file. Follow the instructions.</p>
<p>Create environment setup file for gcc-linaro_work</p>
<pre class="screen">
bmk rm_setup_env_git_gcc-linaro_work
bmk setup_env_git_gcc-linaro_work</pre>

<p>The output of this make command describes the usage of the setup-env file. Follow the instructions.</p>
<p></p>
</div>
<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="idm140495281930912"></a>11.2. Start Tools with GUI for Repositories</h3></div></div></div>


<p>Start tools with GUI like <code class="code">git gui</code> and <code class="code">gitk</code>. </p>
<p>start git gui or gitk  for bsp_local</p>
<pre class="screen">
bmk gui_git_bsp_local</pre>

<p>start git gui or gitk  for bsp_work</p>
<pre class="screen">
bmk gui_git_bsp_work</pre>

<p>start git gui or gitk  for ptxdist_local</p>
<pre class="screen">
bmk gui_git_ptxdist_local</pre>

<p>start git gui or gitk  for ptxdist_work</p>
<pre class="screen">
bmk gui_git_ptxdist_work</pre>

<p>start git gui or gitk  for barebox_local</p>
<pre class="screen">
bmk gui_git_barebox_local</pre>

<p>start git gui or gitk  for barebox_work</p>
<pre class="screen">
bmk gui_git_barebox_work</pre>

<p>start git gui or gitk  for linux_local</p>
<pre class="screen">
bmk gui_git_linux_local</pre>

<p>start git gui or gitk  for linux_work</p>
<pre class="screen">
bmk gui_git_linux_work</pre>

<p>start git gui or gitk  for toolchain_local</p>
<pre class="screen">
bmk gui_git_toolchain_local</pre>

<p>start git gui or gitk  for toolchain_work</p>
<pre class="screen">
bmk gui_git_toolchain_work</pre>

<p>start git gui or gitk  for gcc-linaro_local</p>
<pre class="screen">
bmk gui_git_gcc-linaro_local</pre>

<p>start git gui or gitk  for gcc-linaro_work</p>
<pre class="screen">
bmk gui_git_gcc-linaro_work</pre>

<p>start git gui or gitk  for tftpboot_local</p>
<pre class="screen">
bmk gui_git_tftpboot_local</pre>

<p>start git gui or gitk  for tftpboot_work</p>
<pre class="screen">
bmk gui_git_tftpboot_work</pre>
</div>
<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="idm140495281925152"></a>11.3. Show and Check Repositories</h3></div></div></div>


<p>Show and check current state of the git repositories.  </p>
<p>show branches and HEAD of all repositories</p>
<pre class="screen">
bmk show_branch_git</pre>

<p>check branch and HEAD of all repositories</p>
<pre class="screen">
bmk check_branch_git</pre>

<p>show commit id of release branch</p>
<pre class="screen">
bmk show_release_git</pre>
</div>
<div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="idm140495281905648"></a>11.4. Summary</h3></div></div></div>


<p>Create environment setup files</p>
<pre class="screen">
bmk  \
	rm_setup_env_git_barebox_work \
	rm_setup_env_git_linux_work \
	rm_setup_env_git_gcc-linaro_work
bmk  \
	setup_env_git_barebox_work \
	setup_env_git_linux_work \
	setup_env_git_gcc-linaro_work</pre>

<p>Show and check current state of the git repositories.</p>
<pre class="screen">
bmk  \
	show_branch_git \
	check_branch_git \
	show_release_git</pre>
</div>
</div>
</div></body></html>
